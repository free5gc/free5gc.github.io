<!DOCTYPE html>
<html lang="en" >

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


<meta property="og:title" content="" />
<meta property="og:description" content="Trouble Shooting 1. ERROR: [SCTP] Failed to connect given AMF N3IWF=NGAP This error occured when N3IWF was started before AMF finishing initialization. This error usually appears when you run the TestNon3GPP in the first time.
Rerun the test should be fine. If it still not be solved, larger the sleeping time in line 110 of test." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://free5gc.org/installations/stage-3-trouble-shooting/" />




<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Trouble Shooting 1. ERROR: [SCTP] Failed to connect given AMF N3IWF=NGAP This error occured when N3IWF was started before AMF finishing initialization. This error usually appears when you run the TestNon3GPP in the first time.
Rerun the test should be fine. If it still not be solved, larger the sleeping time in line 110 of test."/>
<meta name="generator" content="Hugo 0.79.1" />

    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "",
  "url": "https://free5gc.org/installations/stage-3-trouble-shooting/",
  "wordCount": "263",
  "datePublished": "0001-01-01T00:00:00+00:00",
  "author": {
    "@type": "Person",
    "name": "Your Name"
  }
}
</script>



    <link rel="canonical" href="https://free5gc.org/installations/stage-3-trouble-shooting/">

    <title> | free5GC</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">

    <!-- combined, minified CSS -->
    
    <link href="https://free5gc.org/css/bootstrap-icons.0568af55d343ad2fc9c221a17a15697dc5ef49add4551c5eb3e59d7582385228.css" rel="stylesheet">
    
    <link href="https://free5gc.org/css/style.73f0736b85bdf48090ed384697200a968c025d194f60717e37a515c4c87a8893.css" rel="stylesheet">

    <!-- minified base javascript -->
    
    <script defer src="https://free5gc.org/js/base.e5993f7509e480925eff41173b2176d6d85ef3df70ad0388d9275d09f0c3d966.js" crossorigin="anonymous"></script>

    

  </head>

  <body>

    
    <header class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
      <p class="h5 my-0 me-md-auto fw-normal">
        <a class="nav-link " href="https://free5gc.org">
          <img src="/img/free5GC.png" width="217" height="51">
        </a>
      </p>
      <nav class="btn-group" role="group" aria-label="Basic outlined example">
          
          <a class="btn btn-outline-primary"
             href="/" title="Home">Home</a>
          
        
          
          <a class="btn btn-outline-primary"
             href="/roadmap/" title="Roadmap">Roadmap</a>
          
        
          
          <div id="btn-group-install" class="btn-group" role="group">
            <button type="button"
                    class="btn btn-outline-primary dropdown-toggle active"
                    data-bs-toggle="dropdown" aria-expanded="false">
              Installations
            </button>
            <ul class="dropdown-menu" aria-labelledby="btn-group-install">
              
              <li><a class="dropdown-item"
                     
                     title="Stage 1: Cluster"
                     href="/installations/stage-1-cluster/">Stage 1: Cluster</a></li>
              
              <li><a class="dropdown-item"
                     
                     title="Stage 1: All-in-one"
                     href="/installations/stage-1-all-in-one/">Stage 1: All-in-one</a></li>
              
              <li><a class="dropdown-item"
                     
                     title="Stage 2: Standalone 5G"
                     href="/installations/stage-2-standalone-5g/">Stage 2: Standalone 5G</a></li>
              
              <li><a class="dropdown-item"
                     
                     title="Stage 3: free5GC"
                     href="/installations/stage-3/">Stage 3: free5GC</a></li>
              
            </ul>
          </div>
          
        
          
          <a class="btn btn-outline-primary"
             href="/membership/" title="Membership">Membership</a>
          
        
          
          <a class="btn btn-outline-primary"
             href="/contactus/" title="Contact Us">Contact Us</a>
          
        
          
          <div id="btn-group-more" class="btn-group" role="group">
            <button type="button"
                    class="btn btn-outline-primary dropdown-toggle"
                    data-bs-toggle="dropdown" aria-expanded="false">
              More
            </button>
            <ul class="dropdown-menu" aria-labelledby="btn-group-more">
              
              <li><a class="dropdown-item"
                     target="_blank"
                     title="Download"
                     href="https://github.com/free5gc/free5gc">Download</a></li>
              
              <li><a class="dropdown-item"
                     target="_blank"
                     title="Youtube"
                     href="https://www.youtube.com/channel/UCywP5Acj50GlhSxZTJXlqtw/videos">Youtube</a></li>
              
              <li><a class="dropdown-item"
                     target="_blank"
                     title="free5GC Forum"
                     href="https://forum.free5gc.org/">free5GC Forum</a></li>
              
              <li><a class="dropdown-item"
                     
                     title="History"
                     href="/history/">History</a></li>
              
            </ul>
          </div>
          
        
      </nav>
    </header>
    

    <div class="container-fluid mx-auto" style="max-width: 960px;">

      


<article class="blog-post">
  <header>
    <h2 class="blog-post-title" dir="auto"><a href="https://free5gc.org/installations/stage-3-trouble-shooting/"></a></h2>
    <p class="blog-post-meta">

</p>
  </header>
  <h2 id="trouble-shooting">Trouble Shooting</h2>
<h4 id="1-error-sctp-failed-to-connect-given-amf----n3iwfngap">1. <code>ERROR: [SCTP] Failed to connect given AMF    N3IWF=NGAP</code></h4>
<p>This error occured when N3IWF was started before AMF finishing initialization. This error usually appears when you run the TestNon3GPP in the first time.</p>
<p>Rerun the test should be fine. If it still not be solved, larger the sleeping time in line 110 of <code>test.sh</code>.</p>
<h4 id="2-testnon3gpp">2. TestNon3GPP</h4>
<p>TestNon3GPP will modify the <code>config/amfcfg.conf</code>. So, if you had killed the TestNon3GPP test before it finished, you might need to copy <code>config/amfcfg.conf.bak</code> back to <code>config/amfcfg.conf</code> to let other tests pass.</p>
<p><code>cp config/amfcfg.conf.bak config/amfcfg.conf</code></p>
<h4 id="3-db-on-tls-to-h2c">3. DB on TLS to H2C</h4>
<p>If you meet any problems about https or mogodb, it maybe couse our new version from v3.0.1 to v3.0.2 has change http to H2C verion. Try the command below.</p>
<p><code>mongo --eval &quot;db.NfProfile.drop()&quot; free5gc</code></p>
<h4 id="4-mqcreate-error-creating-message-queue-too-many-open-files-upfutil-upf">4. <code>MQCreate() Error creating message queue: Too many open files UPF=Util</code> (UPF)</h4>
<p>Remove POSIX message queues</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">ls /dev/mqueue/
rm /dev/mqueue/*
</code></pre></div><h4 id="5-remove-gtp-devices-using-tools-in-libgtp5gnl-upf">5. Remove gtp devices (using tools in libgtp5gnl) (UPF)</h4>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#007020">cd</span> lib/libgtp5gnl/tools
sudo ./gtp5g-link del <span style="color:#666">{</span>Dev-Name<span style="color:#666">}</span>
</code></pre></div><h4 id="6-decode-http2-packet-in-wireshark">6. Decode HTTP/2 packet in Wireshark</h4>
<ol>
<li>
<p>Run Network Function</p>
<p>Check has XXFsslkey.log</p>
</li>
<li>
<p>Edit &raquo; Preference &raquo; Protocols &raquo; SSL (TLS)</p>
<p><img src="https://i.imgur.com/dzzMib5.png" alt=""></p>
</li>
<li>
<p>Add keylog</p>
<p><img src="https://i.imgur.com/gV7x5QU.png" alt=""></p>
</li>
<li>
<p>Filter http2</p>
<p><img src="https://i.imgur.com/ctBIYQy.png" alt=""></p>
</li>
</ol>
<h4 id="7-decode-h2c-http2-clear-text-without-tls">7. Decode H2C (HTTP2 clear text without TLS)</h4>
<p>The similar reason as NEA0 NAS message. Althrough H2C is clear text, wirshark still considers these packets as the normal TCP packets and does not decode them by HTTP2.</p>
<p>To see the details of H2C packets, do the following configuration.</p>
<ol>
<li>
<p>Analyze → Decode As…</p>
<p><img src="https://i.imgur.com/NJ2brow.png" alt=""></p>
</li>
<li>
<p>click Add button to add the decode rules</p>
<p><img src="https://i.imgur.com/Ct4KLgO.png" alt=""></p>
<p>Decode the packets from the TCP ports listened by each NF as HTTP2 packets.</p>
</li>
</ol>


  

  
  <hr>
  <footer>

  
    <section>
    <h4></h4>
    <nav class="nav sharing-icons">
      <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ffree5gc.org%2finstallations%2fstage-3-trouble-shooting%2f" title="Share on Facebook"><span class="fab fa-facebook-f fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ffree5gc.org%2finstallations%2fstage-3-trouble-shooting%2f" title="Share on LinkedIn"><span class="fab fa-linkedin-in fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://twitter.com/intent/tweet?url=https%3a%2f%2ffree5gc.org%2finstallations%2fstage-3-trouble-shooting%2f&amp;text=" title="Tweet this"><span class="fab fa-twitter fa-2x"></span></a>
    </nav>
  </section>


  

  
  </footer>
  

</article> 



      
      <footer class="pt-4 my-md-5 pt-md-5 border-top">
        <div class="row">
          <div class="col-12 col-md">
	    <a href="https://free5gc.org"><img class="mb-2" src="/img/free5GC.png" alt="" height="32"></a>
            <small class="d-block mb-1 text-muted">&copy; Copyright January 2019 free5GC.org</small>
            <small class="d-block mb-1 text-muted">All rights reserved.</small>
          </div>
          <div class="col-6 col-md">
            <h5>Contact:</h5>
            <ul class="list-unstyled text-small">
              <li>
                <a class="link-secondary" href="mailto:free5GC.org@gmail.com"
                   target="_self"><span style="text-decoration:underline">free5GC.org@gmail.com</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </footer>
      
    </div> <!-- /.container-fluid -->
  </body>

</html>

