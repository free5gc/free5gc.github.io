
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/icon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.3">
    
    
      
        <title>Authentication Mechanism in NRF: What Is OAuth? - free5GC</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.79e020e9.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a5377069.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#authentication-mechanism-in-nrf-what-is-oauth" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="free5GC" class="md-header__button md-logo" aria-label="free5GC" data-md-component="logo">
      
  <img src="../../../assets/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            free5GC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Authentication Mechanism in NRF: What Is OAuth?
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/free5gc/free5gc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    free5GC
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../guide/" class="md-tabs__link">
        
  
    
  
  User Guide

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../doc/" class="md-tabs__link">
        
  
    
  
  Documents

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/free5gc/free5GLab" class="md-tabs__link">
        
  
    
  
  Tutorials

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
    
  
  Blogs

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../support/" class="md-tabs__link">
        
  
    
  
  Supports

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../publication/" class="md-tabs__link">
          
  
    
  
  More

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="free5GC" class="md-nav__button md-logo" aria-label="free5GC" data-md-component="logo">
      
  <img src="../../../assets/icon.png" alt="logo">

    </a>
    free5GC
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/free5gc/free5gc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    free5GC
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documents
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/free5gc/free5GLab" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blogs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supports
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    More
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            More
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../publication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relavent Publications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../videos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Other Videos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#abstract" class="md-nav__link">
    Abstract
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oauth" class="md-nav__link">
    OAuth
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-credentials-flow" class="md-nav__link">
    Client Credentials Flow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-credentials-flow-in-nrf" class="md-nav__link">
    Client Credentials Flow in NRF
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nnrf_accesstoken-service" class="md-nav__link">
    Nnrf_AccessToken Service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experiment" class="md-nav__link">
    Experiment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about" class="md-nav__link">
    About
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/free5gc/free5gc.github.io/blob/main/docs/blog/20230802/20230802.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/free5gc/free5gc.github.io/raw/main/docs/blog/20230802/20230802.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="authentication-mechanism-in-nrf-what-is-oauth">Authentication Mechanism in NRF: What Is OAuth?</h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Author: Wilson<br />
Date: 2023/8/2</p>
</div>
<h2 id="abstract">Abstract</h2>
<p>Regarding the theme this time, I will briefly introduce <strong>OAuth</strong>. OAuth 2.0 defines four types of authorization flows. I choose the <strong>Client Credentials Flow</strong> to explain because the authentication mechanism in NRF is closely related to the Client Credentials Flow.</p>
<p>Next, I will explain <strong>how to apply the concept of the Client Credentials Flow to NRF</strong> and introduce <strong><code>Nnrf_AccessToken Service</code></strong>, because <code>Nnrf_AccessToken Service</code> is closely related to the Client Credentials Flow.</p>
<p>Finally, I will make <strong>a simple experiment of the authentication mechanism in NRF</strong> and share the environment settings and methods of operation.</p>
<h2 id="oauth">OAuth</h2>
<p>Before explaining the authentication mechanism in NRF, I will introduce OAuth. Regarding the OAuth flow, we can log in to the account through the platform before accessing an application. After logging in, we agree that an application can limitedly obtain the information of the user on the platform. The application can be LinkedIn, YouTube, etc. The platform can be Google, Facebook, etc.</p>
<p>The full English name of OAuth is Open standard Authorization. <strong>OAuth</strong> is an <strong>open standard</strong>, and it's used to <strong>deal with authorization-related behaviors</strong>. OAuth 2.0 defines four types of authorization flows. The four types of the authorization flows are:</p>
<ul>
<li>Authorization Code</li>
<li>Implicit</li>
<li>Resource Owner Password Credentials</li>
<li>Client Credentials</li>
</ul>
<p>This article explains the entire authorization of the Client Credentials Flow only, because <strong>the authentication mechanism in NRF adopts the Client Credentials</strong>.</p>
<blockquote>
<p>If you're interested in how authorization mechanism works, please refer to <a href="https://medium.com/%E9%BA%A5%E5%85%8B%E7%9A%84%E5%8D%8A%E8%B7%AF%E5%87%BA%E5%AE%B6%E7%AD%86%E8%A8%98/%E7%AD%86%E8%A8%98-%E8%AA%8D%E8%AD%98-oauth-2-0-%E4%B8%80%E6%AC%A1%E4%BA%86%E8%A7%A3%E5%90%84%E8%A7%92%E8%89%B2-%E5%90%84%E9%A1%9E%E5%9E%8B%E6%B5%81%E7%A8%8B%E7%9A%84%E5%B7%AE%E7%95%B0-c42da83a6015">this article</a> for more details.</p>
</blockquote>
<h2 id="client-credentials-flow">Client Credentials Flow</h2>
<p><img alt="" src="../20230802figure1.png" /><br />
<br/><strong>Figure 1. Client Credentials Flow</strong></p>
<p>Referring to the Figure 1, the Client Credentials Flow is mainly composed of:</p>
<ul>
<li>Client</li>
<li>Authorization Server</li>
<li>Resource Server</li>
</ul>
<p>The entire authorization of the Client Credentials Flow can be devided into 3 steps:</p>
<ul>
<li>First, the Client provdies <strong>Client ID</strong>, <strong>Client Secret Token</strong>, <strong>Scope</strong>, and <strong>Grant Type</strong> to the Authorization Server.</li>
<li>Second, the Authorization Server verifies the information provided by the Client. After the Authorization Server verifies the information, it <strong>signs with the private key</strong> and <strong>sends the Access Token</strong> to the Client.</li>
<li>Third, the Client obtains resources from the Resource Server with the Access Token.</li>
</ul>
<p>In addition, the Client and the Authorization Server have their own Scope list. The Scope list records a series of the actions. The Client or the Authorization Server is permitted to do the actions for obtaining the user’s name, deleting posts, etc.</p>
<p>Below I will explain how to apply the Client Credentials Flow to NRF after talking about the Client Credentials Flow.</p>
<h2 id="client-credentials-flow-in-nrf">Client Credentials Flow in NRF</h2>
<p>The Figure 2 and the Figure 3 originate from <em>the Figure 13.4.1.1-1</em> and <em>the Figure 13.4.1.1-2</em> of the <em>TS 33.501</em>.</p>
<p><img alt="" src="../20230802figure2.png" /><br />
<br/><strong>Figure 2. NF Service Consumer Obtaining Access Token before NF Service Access</strong></p>
<p>The entire flow in Figure 2 is the same as Step 1 and Step 2 in the Figure 1. The role of the <strong>Client</strong> is played by the <strong>NF Service Consumer</strong>, and the role of the <strong>Authorization Server</strong> is played by the <strong>NRF</strong>.</p>
<p>First, the NF Service Consumer registers with NRF. Then the NF Service Consumer sends the <code>Nnrf_AccessToken_Get Request</code> to NRF. The <code>Nnrf_AccessToken_Get Request</code> includes:</p>
<ul>
<li>Consumer NF Type</li>
<li>Expected NF Type</li>
<li>Expected NF Service Name</li>
<li>Client ID</li>
</ul>
<p>The NF Type can be AMF, SMF, etc. , and the NF Service Name can be <code>namf-comm</code>, <code>nsmf-pdusession</code>, etc.</p>
<p>NRF verifies the information provided by the NF Service Consumer after it receives the <code>Nnrf_AccessToken_Get Request</code>. NRF <strong>generates an Access Token</strong> and <strong>uses the NRF private key to sign on the Access Token</strong> after the verification is successful.</p>
<p>Finally, NRF returns the <code>Nnrf_AccessToken_Get Response</code> to the NF Service Consumer. The <strong>NF Service Consumer stores the Access Token within the validity period</strong> after it gets the Access Token. <strong>The services provided by the NF Service Producer are in the Expected NF Service Name.</strong> The NF Service Consumer <strong>doesn’t need to verify again</strong> when it wants to use the services provided by the NF Service Producer.</p>
<p><img alt="" src="../20230802figure3.png" /><br />
<br/><strong>Figure 3. NF Service Consumer Requesting Service Access with an Access Token</strong></p>
<p>The entire flow in Figure 3 is the same as Step 3 in the Figure 1. The role of the <strong>Client</strong> is played by the <strong>NF Service Consumer</strong>, and the role of the <strong>Resource Server</strong> is played by the <strong>NF Service Producer</strong>.</p>
<p>First, the NF Service Consumer sends the <code>NF Service Request</code> to the NF Service Producer with the Access Token. Simply put, the NF Service Consumer wants to consume the service provided by the NF Service Producer.</p>
<p><strong>The NF Service Producer uses the NRF public key to verify the signed Access Token</strong> after it receives the <code>NF Service Request</code>. If the verification is successful, the NF Service Producer will send the <code>NF Service Response</code> to the NF Service Consumer.</p>
<p>Now I will talk about the <code>Nnrf_AccessToken Service</code> after explaining how to apply the Client Credentials Flow to NRF.</p>
<h2 id="nnrf_accesstoken-service">Nnrf_AccessToken Service</h2>
<p><img alt="" src="../20230802figure4.png" /><br />
<br/><strong>Figure 4. Access Token Request</strong></p>
<p>The Figure 4 originates from the <em>Figure 5.4.2.2.1-1</em> of the <em>TS 29.510</em>.</p>
<p>First, the NF Service Consumer sends the POST <code>/oauth2/token</code> to NRF, and the data is stored in the <code>AccessTokenReq</code>. The <strong>attribute name</strong>, the <strong>data type</strong>, and the <strong>formulation rule</strong> of the <code>AccessTokenReq</code> are shown in the Table 1. The Table 1 originates from the <em>Table 6.3.5.2.2-1</em> of the <em>TS 29.510</em>.</p>
<p><img alt="" src="../20230802table1.png" /><br />
<br/><strong>Table 1. Definition of Type AccessTokenReq</strong></p>
<p>Definition of type <code>AccessTokenReq</code>:</p>
<ul>
<li><code>grant_type</code>: The value must be set to the <strong>client_credentials</strong>, and it is checked in the Snippet 1.</li>
<li><code>nfInstanceId</code>: The value stores the <strong>ID of the NF Service Consumer</strong>.</li>
<li><code>targetNfInstanceId</code>: The value stores the <strong>ID of the NF Service Producer</strong>.</li>
<li><code>nfType</code>: The value stores the <strong>network function name of the NF Service Consumer</strong>. The network function name can be the AMF, SMF, etc.</li>
<li><code>targetNfType</code>: The value stores the <strong>network function name of the NF Service Producer</strong>.</li>
<li><code>scope</code>: <strong>It stores the services. The services can be the <code>namf-comm</code>, <code>nsmf-pdusession</code>, etc.</strong> When the NF Service Consumer requests the services. The services will be provided by the NF Service Producer.</li>
<li><code>requesterPlmn</code>: It is mainly used in the <strong>roaming</strong>.</li>
<li><code>targetPlmn</code>: It is mainly used in the <strong>roaming</strong>.</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="nx">reqGrantType</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;client_credentials&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">models</span><span class="p">.</span><span class="nx">AccessTokenErr</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Error</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;unsupported_grant_type&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><br />
<strong>Snippet 1. Grant Type Value Checking</strong></p>
<p>NRF sends <code>AccessTokenRsp</code> to the NF Service Consumer in the Step 2a of the Figure 4. The <strong>attribute name</strong>, the <strong>data type</strong>, and the <strong>formulation rule</strong> of the <code>AccessTokenRsp</code> are shown in the Table 2. The Table 2 originates from the <em>Table 6.3.5.2.3-1</em> of the <em>TS 29.510</em>.</p>
<p><img alt="" src="../20230802table2.png" /><br />
<br/><strong>Table 2. Definition of Type AccessTokenRsp</strong></p>
<p>The <code>AccessTokenRsp</code> contains four attribute names. The four attribute names are:</p>
<ul>
<li><code>access_token</code>: It <strong>stores all the attribute names and values of the AccessTokenClaims</strong> in the Table 3. The Table 3 originates form the <em>Table 6.3.5.2.4-1</em> of the <em>TS 29.510</em>.</li>
<li><code>token_type</code>: It must be set to the <strong>Bearer</strong> and can be seen in the Snippet 2.</li>
<li><code>expires_in</code>: It stores information related to the <strong>expiration date</strong>.</li>
<li><code>scope</code>: The NF Service Consumer and the NF Service Producer have their own scope list. <strong>The scope in the <code>AccessTokenRsp</code></strong> has a series of these services, and the <strong>NF Service Producer is permitted to consume these services</strong>.</li>
</ul>
<p><img alt="" src="../20230802table3.png" /><br />
<br/><strong>Table 3. Definition of Type AccessTokenClaims</strong></p>
<p>Definition of Type <code>AccessTokenClaims</code>:</p>
<ul>
<li><code>iss</code>: It is called issuer, and the content usually stores the <strong>ID of NRF</strong>.</li>
<li><code>sub</code>: It is called subject, and the content stores the <strong>ID of the NF Service Consumer</strong>.</li>
<li><code>aud</code>: It is called audience, and the content stores the <strong>ID of the NF Service Producer</strong>.</li>
<li><code>scope</code>: <strong>The scope in the <code>AccessTokenClaims</code></strong> has a series of these services, and the <strong>NF Service Consumer is authorized by the NF Service Producer and permitted to consume these services</strong>.</li>
<li><code>exp</code>: It stores information related to the <strong>validity period</strong>.</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">AccessTokenProcedure</span><span class="p">(</span><span class="nx">request</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">AccessTokenReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">AccessTokenRsp</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">AccessTokenErr</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">AccTokenLog</span><span class="p">.</span><span class="nx">Infoln</span><span class="p">(</span><span class="s">&quot;In AccessTokenProcedure&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">expiration</span><span class="w"> </span><span class="kt">int32</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">    </span><span class="nx">scope</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">Scope</span>
<span class="w">    </span><span class="nx">tokenType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Bearer&quot;</span>
<span class="w">    </span><span class="nx">now</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">int32</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Unix</span><span class="p">())</span>

<span class="w">    </span><span class="nx">errResponse</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">AccessTokenScopeCheck</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errResponse</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errResponse</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Create AccessToken</span>
<span class="w">    </span><span class="nx">nrfCtx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">nrf_context</span><span class="p">.</span><span class="nx">GetSelf</span><span class="p">()</span>
<span class="w">    </span><span class="nx">accessTokenClaims</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">AccessTokenClaims</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Iss</span><span class="p">:</span><span class="w">            </span><span class="nx">nrfCtx</span><span class="p">.</span><span class="nx">Nrf_NfInstanceID</span><span class="p">,</span><span class="w">    </span><span class="c1">// NF instance id of the NRF</span>
<span class="w">        </span><span class="nx">Sub</span><span class="p">:</span><span class="w">            </span><span class="nx">request</span><span class="p">.</span><span class="nx">NfInstanceId</span><span class="p">,</span><span class="w">       </span><span class="c1">// nfInstanceId of service consumer</span>
<span class="w">        </span><span class="nx">Aud</span><span class="p">:</span><span class="w">            </span><span class="nx">request</span><span class="p">.</span><span class="nx">TargetNfInstanceId</span><span class="p">,</span><span class="w"> </span><span class="c1">// nfInstanceId of service producer</span>
<span class="w">        </span><span class="nx">Scope</span><span class="p">:</span><span class="w">          </span><span class="nx">request</span><span class="p">.</span><span class="nx">Scope</span><span class="p">,</span><span class="w">              </span><span class="c1">// TODO: the name of the NF services for which the</span>
<span class="w">        </span><span class="nx">Exp</span><span class="p">:</span><span class="w">            </span><span class="nx">now</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">expiration</span><span class="p">,</span><span class="w">           </span><span class="c1">// access_token is authorized for use</span>
<span class="w">        </span><span class="nx">StandardClaims</span><span class="p">:</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">StandardClaims</span><span class="p">{},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">accessTokenClaims</span><span class="p">.</span><span class="nx">IssuedAt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="nx">now</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Use NRF private key to sign AccessToken</span>
<span class="w">    </span><span class="nx">token</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">NewWithClaims</span><span class="p">(</span><span class="nx">jwt</span><span class="p">.</span><span class="nx">GetSigningMethod</span><span class="p">(</span><span class="s">&quot;RS512&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">accessTokenClaims</span><span class="p">)</span>
<span class="w">    </span><span class="nx">accessToken</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">token</span><span class="p">.</span><span class="nx">SignedString</span><span class="p">(</span><span class="nx">nrfCtx</span><span class="p">.</span><span class="nx">NrfPrivKey</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">logger</span><span class="p">.</span><span class="nx">AccTokenLog</span><span class="p">.</span><span class="nx">Warnln</span><span class="p">(</span><span class="s">&quot;Signed string error: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">models</span><span class="p">.</span><span class="nx">AccessTokenErr</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Error</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;invalid_request&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">models</span><span class="p">.</span><span class="nx">AccessTokenRsp</span><span class="p">{</span>
<span class="w">        </span><span class="nx">AccessToken</span><span class="p">:</span><span class="w"> </span><span class="nx">accessToken</span><span class="p">,</span>
<span class="w">        </span><span class="nx">TokenType</span><span class="p">:</span><span class="w">   </span><span class="nx">tokenType</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ExpiresIn</span><span class="p">:</span><span class="w">   </span><span class="nx">expiration</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Scope</span><span class="p">:</span><span class="w">       </span><span class="nx">scope</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div><br />
<strong>Snippet 2. AccessTokenProcedure Function</strong></p>
<p>The Snippet 2 is the <code>AccessTokenProcedure()</code> function. The function is executed in NRF.</p>
<p>The function mainly processes:</p>
<ol>
<li>The NRF receives the <code>AccessTokenReq</code> sent by the NF Service Consumer.</li>
<li>The function calls the <code>AccessTokenScopeCheck()</code> function. <strong>The <code>AccessTokenScopeCheck()</code> function checks whether the content of the attribute name in the <code>AccessTokenReq</code> complies with the requirements of the <em>TS 29.510</em>.</strong> If not, the <code>AccessTokenProcedure()</code> function immediately returns the <code>AccessTokenErr</code> to the NF Service Consumer.</li>
<li><strong>The function starts to create the Access Token</strong>. The Access Token is stored in the <code>AccessTokenRsp</code>. The <code>AccessTokenRsp</code> is sent back to the NF Service Consumer. The <code>Iss</code> in the AccessToken obtains its own ID in NRF. The <code>Sub</code> and <code>Aud</code> are obtained from the <code>NfInstancedId</code> and the <code>TargetNfInstanceId</code> in the <code>AccessTokenReq</code> respectively. The <code>Scope</code> is obtained from the <code>scope</code> in the <code>AccessTokenReq</code>. The expiration is set to the 1000 in the Snippet 2. Therefore, the value of the <code>exp</code> is the current time + 1000.</li>
<li>After the Access Token is created, <strong>the function uses the NRF private key to sign on the Access Token</strong>. After signing, the function checks whether there is an error. If so, the function immediately sends the <code>AccessTokenErr</code> to the NF Service Consumer.</li>
<li><strong>The function puts the signed Access Token into the <code>AccessTokenRsp</code></strong>. The value of the <code>TokenType</code> is set to the <strong>Bearer</strong> by the function. The function sets the <code>ExprieIn</code> and the <code>Scope</code> in the Snippet 2.</li>
</ol>
<p>Finally, I make a simple experiment about the Access Token and share the environment setting and method of operation with you.</p>
<h2 id="experiment">Experiment</h2>
<p>The Table 4 is my environment setting. I provide the Table 4 for you. You can refer it.</p>
<p><img alt="" src="../20230802table4.png" /><br />
<br/><strong>Table 4. Environment</strong></p>
<p>Remove the part of the <code>tls</code> and add the content of the <code>cert</code>, <code>rootcert</code> and <code>oauth</code> under <code>sbi</code> in the <code>nrfcfg.yaml</code> before implementing about the Access Token.</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">info</span><span class="p">:</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0.2</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NRF initial local configuration</span>

<span class="nt">configuration</span><span class="p">:</span>
<span class="w">  </span><span class="nt">MongoDBName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">free5gc</span><span class="w"> </span><span class="c1"># database name in MongoDB</span>
<span class="w">  </span><span class="nt">MongoDBUrl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb://127.0.0.1:27017</span><span class="w"> </span><span class="c1"># a valid URL of the mongodb</span>
<span class="w">  </span><span class="nt">sbi</span><span class="p">:</span><span class="w"> </span><span class="c1"># Service-based interface information</span>
<span class="w">    </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"> </span><span class="c1"># the protocol for sbi (http or https)</span>
<span class="w">    </span><span class="nt">registerIPv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.10</span><span class="w"> </span><span class="c1"># IP used to serve NFs or register to another NRF</span>
<span class="w">    </span><span class="nt">bindingIPv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.10</span><span class="w">  </span><span class="c1"># IP used to bind the service</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span><span class="w"> </span><span class="c1"># port used to bind the service</span>
<span class="w">    </span><span class="nt">cert</span><span class="p">:</span>
<span class="w">      </span><span class="nt">pem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert/nrf.pem</span>
<span class="w">      </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert/nrf.key</span>
<span class="w">    </span><span class="nt">rootcert</span><span class="p">:</span>
<span class="w">      </span><span class="nt">pem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert/nrf.pem</span>
<span class="w">      </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert/nrf.key</span>
<span class="w">    </span><span class="nt">oauth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">DefaultPlmnId</span><span class="p">:</span>
<span class="w">    </span><span class="nt">mcc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">208</span><span class="w"> </span><span class="c1"># Mobile Country Code (3 digits string, digit: 0~9)</span>
<span class="w">    </span><span class="nt">mnc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">93</span><span class="w"> </span><span class="c1"># Mobile Network Code (2 or 3 digits string, digit: 0~9)</span>
<span class="w">  </span><span class="nt">serviceNameList</span><span class="p">:</span><span class="w"> </span><span class="c1"># the SBI services provided by this NRF, refer to TS 29.510</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nnrf-nfm</span><span class="w"> </span><span class="c1"># Nnrf_NFManagement service</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nnrf-disc</span><span class="w"> </span><span class="c1"># Nnrf_NFDiscovery service</span>

<span class="nt">logger</span><span class="p">:</span><span class="w"> </span><span class="c1"># log output setting</span>
<span class="w">  </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># true or false</span>
<span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span><span class="w"> </span><span class="c1"># how detailed to output, value: trace, debug, info, warn, error, fatal, panic</span>
<span class="w">  </span><span class="nt">reportCaller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"> </span><span class="c1"># enable the caller report or not, value: true or false</span>
</code></pre></div><br />
<strong>nrfcfg.yaml</strong></p>
<p>Find the <code>http://127.0.0.10:8000/nnrf-nfm/v1/nf-instances/8f7891b4-b127-4f59-9ec2-b5e6aade5531</code> in the NRF log, and you will get the <code>8f7891b4-b127-4f59-9ec2-b5e6aade5531</code>. The <code>8f7891b4-b127-4f59-9ec2-b5e6aade5531</code> is the <code>nfInstanceID</code>.</p>
<div class="highlight"><pre><span></span><code>2023-08-02T20:07:43.300826205Z [INFO][NRF][NFM] Handle NFRegisterRequest
2023-08-02T20:07:43.308259291Z [INFO][NRF][NFM] urilist create
2023-08-02T20:07:43.311674255Z [INFO][NRF][NFM] Create NF Profile
2023-08-02T20:07:43.318192771Z [INFO][NRF][NFM] Location header:  http://127.0.0.10:8000/nnrf-nfm/v1/nf-instances/8f7891b4-b127-4f59-9ec2-b5e6aade5531
2023-08-02T20:07:43.325073275Z [INFO][NRF][GIN] | 201 |       127.0.0.1 | PUT     | /nnrf-nfm/v1/nf-instances/8f7891b4-b127-4f59-9ec2-b5e6aade5531 |
</code></pre></div>
<p>Execute <code>$ curl -X GET {apiRoot}/nnrf-nfm/v1/nf-instances/{nfInstanceID}</code>, and you will obtain the detail information about the <code>nfInstanceID</code>. You can see the <code>nfType</code> of the <code>nfInstanceID</code> is NSSF, and the information about the <code>nfInstanceID</code> is used when you implement the Access Token.</p>
<div class="highlight"><pre><span></span><code>ubuntu@free5GC:~/free5gc/NFs/nrf$ curl -X GET http://127.0.0.10:8000/nnrf-nfm/v1/nf-instances/8f7891b4-b127-4f59-9ec2-b5e6aade5531
{&quot;ipv4Addresses&quot;:[&quot;127.0.0.31&quot;],&quot;nfInstanceId&quot;:&quot;8f7891b4-b127-4f59-9ec2-b5e6aade5531&quot;,&quot;nfServices&quot;:[{&quot;apiPrefix&quot;:&quot;http://127.0.0.31:8000&quot;,&quot;ipEndPoints&quot;:[{&quot;ipv4Address&quot;:&quot;127.0.0.31&quot;,&quot;port&quot;:8000,&quot;transport&quot;:&quot;TCP&quot;}],&quot;nfServiceStatus&quot;:&quot;REGISTERED&quot;,&quot;scheme&quot;:&quot;http&quot;,&quot;serviceInstanceId&quot;:&quot;0&quot;,&quot;serviceName&quot;:&quot;nnssf-nsselection&quot;,&quot;versions&quot;:[{&quot;apiFullVersion&quot;:&quot;1.0.2&quot;,&quot;apiVersionInUri&quot;:&quot;v1&quot;}]},{&quot;apiPrefix&quot;:&quot;http://127.0.0.31:8000&quot;,&quot;ipEndPoints&quot;:[{&quot;ipv4Address&quot;:&quot;127.0.0.31&quot;,&quot;port&quot;:8000,&quot;transport&quot;:&quot;TCP&quot;}],&quot;nfServiceStatus&quot;:&quot;REGISTERED&quot;,&quot;scheme&quot;:&quot;http&quot;,&quot;serviceInstanceId&quot;:&quot;1&quot;,&quot;serviceName&quot;:&quot;nnssf-nssaiavailability&quot;,&quot;versions&quot;:[{&quot;apiFullVersion&quot;:&quot;1.0.2&quot;,&quot;apiVersionInUri&quot;:&quot;v1&quot;}]}],&quot;nfStatus&quot;:&quot;REGISTERED&quot;,&quot;nfType&quot;:&quot;NSSF&quot;,&quot;plmnList&quot;:[{&quot;mcc&quot;:&quot;208&quot;,&quot;mnc&quot;:&quot;93&quot;}]}
</code></pre></div>
<p>Then you execute this command, see below.<br />
<div class="highlight"><pre><span></span><code>$ curl -X POST -H &quot;Content-Type: application/json&quot; -d &#39;{&quot;nfInstanceId&quot;: {nfInstanceID}, &quot;grant_type&quot;: &quot;client_credentials&quot;, &quot;nfType&quot;: {nfType}, &quot;targetNfType&quot;: &quot;UDR&quot;, &quot;scope&quot;: &quot;nudr-dr&quot;}&#39; {apiRoot}/oauth2/token
</code></pre></div><br />
You will get the long symbols. The long symbols is that the Access Token is encrypted by the private key of NRF and stored in the <code>AccessTokenRsp</code>.</p>
<div class="highlight"><pre><span></span><code>ubuntu@free5GC:~/free5gc/NFs/nrf$ curl -X POST -H &quot;Content-Type: application/json&quot; -d &#39;{&quot;nfInstanceId&quot;: &quot;8f7891b4-b127-4f59-9ec2-b5e6aade5531&quot;, &quot;grant_type&quot;: &quot;client_credentials&quot;, &quot;nfType&quot;: &quot;NSSF&quot;, &quot;targetNfType&quot;: &quot;UDR&quot;, &quot;scope&quot;: &quot;nudr-dr&quot;}&#39; http://127.0.0.10:8000/oauth2/token
&quot;eyJhY2Nlc3NfdG9rZW4iOiJleUpoYkdjaU9pSlNVelV4TWlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKcGMzTWlPaUlpTENKemRXSWlPaUk0WmpjNE9URmlOQzFpTVRJM0xUUm1OVGt0T1dWak1pMWlOV1UyWVdGa1pUVTFNekVpTENKaGRXUWlPaUlpTENKelkyOXdaU0k2SW01MVpISXRaSElpTENKbGVIQWlPakUyT1RFd01EZzBPRGdzSW1saGRDSTZNVFk1TVRBd056UTRPSDAuY3VHSkkwTndfV280S2lQbS1fZEZVdnVTQWM1WVEwMmRKYk5PTUhmMV9IOHdIZ2JKWFhUam9xU1Y2OTNYSmFKemkweGIxdC1DMW14TWhVZkZjbXpNMC1Nd2oxTXZYaWhyTTktdDFRUFItSFcxQlBlN0tHMUxBV3d5MEJfcXpIalltRlR6eGhONVlyNkpURDhBbkMxaFJFeEh4WHBjV1NqbV9vZnV0NVhfUFRFRkZtaHZrbmtVbU8waWFrTmdRWElRVTc1NnlvZ29ZTlFDRnJvSmRWamJMdnpFdkJLYTVFN0hQeXc3RkRDRHpTZU5WT2t2WTlobU11eldYZ3dOVmRIT3c1c2lNbmppbTlmTVZ0RTFxS1hjWDlScXlUdXlsWjM2ZlJ1QjdVZ2hkLU15Q19xd2VJRE41ZFdYOWZqdnA3VUNZZ01mVHhSLUI2M3d5OWFjQ183eThRIiwidG9rZW5fdHlwZSI6IkJlYXJlciIsImV4cGlyZXNfaW4iOjEwMDAsInNjb3BlIjoibnVkci1kciJ9&quot;
</code></pre></div>
<p>NSSF sends the <code>AccessTokenReq</code> to NRF after you execute the above command. In the <code>AccessTokenReq</code>, the <code>nfInstanceId</code> is set to <code>8f7891b4-b127-4f59-9ec2-b5e6aade5531</code>. The <code>grant_type</code> is set to the <strong>client_credentials</strong>. The <code>nfType</code> is set to NSSF. The <code>targetNfType</code> is set to UDR. The <code>scope</code> is set to <code>nudr-dr</code>. The information is shown in the NRF log. The value of the <code>targetNfInstanceId</code>, <code>requesterPlmn</code>, and <code>targetPlmn</code> is empty because they are not set.</p>
<div class="highlight"><pre><span></span><code>2023-08-02T20:18:08.127557565Z [INFO][NRF][Token] In AccessTokenProcedure
2023-08-02T20:18:08.127586736Z [INFO][NRF][Token] Access Token Request
2023-08-02T20:18:08.127611885Z [INFO][NRF][Token] Grant Type: client_credentials
2023-08-02T20:18:08.127637480Z [INFO][NRF][Token] NF Instance ID: 8f7891b4-b127-4f59-9ec2-b5e6aade5531
2023-08-02T20:18:08.127664415Z [INFO][NRF][Token] Target NF Instance ID:
2023-08-02T20:18:08.127689792Z [INFO][NRF][Token] NF Type: NSSF
2023-08-02T20:18:08.127712916Z [INFO][NRF][Token] Target NF Type: UDR
2023-08-02T20:18:08.127734827Z [INFO][NRF][Token] Scope: nudr-dr
2023-08-02T20:18:08.127758317Z [INFO][NRF][Token] Requester PLMN: &lt;nil&gt;
2023-08-02T20:18:08.127781052Z [INFO][NRF][Token] Target PLMN: &lt;nil&gt;
</code></pre></div>
<p>Next, you can see the Access Token in the NRF log. The value of the <code>Sub</code> is <code>8f7891b4-b127-4f59-9ec2-b5e6aade5531</code>. The <code>Sub</code> represents NSSF, and NSSF belongs to the NF Service Consumer. The value of the <code>Scope</code> is the <code>nudr-dr</code>. The value of the <code>Exp</code> is 1691008488.</p>
<div class="highlight"><pre><span></span><code>2023-08-02T20:18:08.134096785Z [INFO][NRF][Token] Access Token Claims
2023-08-02T20:18:08.138100978Z [INFO][NRF][Token] Iss:
2023-08-02T20:18:08.138185972Z [INFO][NRF][Token] Sub: 8f7891b4-b127-4f59-9ec2-b5e6aade5531
2023-08-02T20:18:08.138228925Z [INFO][NRF][Token] Aud:
2023-08-02T20:18:08.138264519Z [INFO][NRF][Token] Scope: nudr-dr
2023-08-02T20:18:08.138298628Z [INFO][NRF][Token] Exp: 1691008488
</code></pre></div>
<p>Next, you can see the <code>AccessTokenRsp</code>. You can see that the Access Token has become the long symbols. The value of the <code>Token Type</code> is set to the <strong>Bearer</strong>. The value of the <code>ExpiresIn</code> is set to 1000. The value of the <code>Scope</code> is set to <code>nudr-dr</code>.</p>
<div class="highlight"><pre><span></span><code>2023-08-02T20:18:08.149587382Z [INFO][NRF][Token] Access Token Response
2023-08-02T20:18:08.150006665Z [INFO][NRF][Token] Access Token: eyJhbGciOiJSUzUxMiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiIiLCJzdWIiOiI4Zjc4OTFiNC1iMTI3LTRmNTktOWVjMi1iNWU2YWFkZTU1MzEiLCJhdWQiOiIiLCJzY29wZSI6Im51ZHItZHIiLCJleHAiOjE2OTEwMDg0ODgsImlhdCI6MTY5MTAwNzQ4OH0.cuGJI0Nw_Wo4KiPm-_dFUvuSAc5YQ02dJbNOMHf1_H8wHgbJXXTjoqSV693XJaJzi0xb1t-C1mxMhUfFcmzM0-Mwj1MvXihrM9-t1QPR-HW1BPe7KG1LAWwy0B_qzHjYmFTzxhN5Yr6JTD8AnC1hRExHxXpcWSjm_ofut5X_PTEFFmhvknkUmO0iakNgQXIQU756yogoYNQCFroJdVjbLvzEvBKa5E7HPyw7FDCDzSeNVOkvY9hmMuzWXgwNVdHOw5siMnjim9fMVtE1qKXcX9RqyTuylZ36fRuB7Ughd-MyC_qweIDN5dWX9fjvp7UCYgMfTxR-B63wy9acC_7y8Q
2023-08-02T20:18:08.150094277Z [INFO][NRF][Token] Token Type: Bearer
2023-08-02T20:18:08.150133189Z [INFO][NRF][Token] Expires In: 1000
2023-08-02T20:18:08.150167371Z [INFO][NRF][Token] Scope: nudr-dr
</code></pre></div>
<p>Finally, you can see 200. 200 means that AUSF sends the <code>AccessTokenReq</code> to NRF. NRF successfully sends to AUSF after verification.</p>
<div class="highlight"><pre><span></span><code>2023-08-02T20:18:08.150302345Z [INFO][NRF][GIN] | 200 |       127.0.0.1 | POST    | /oauth2/token |
</code></pre></div>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://www.etsi.org/deliver/etsi_ts/129500_129599/129510/15.00.00_60/ts_129510v150000p.pdf">TS 29.510</a></li>
<li><a href="https://www.etsi.org/deliver/etsi_ts/133500_133599/133501/15.15.00_60/ts_133501v151500p.pdf">TS 33.501</a></li>
<li><a href="https://medium.com/%E9%BA%A5%E5%85%8B%E7%9A%84%E5%8D%8A%E8%B7%AF%E5%87%BA%E5%AE%B6%E7%AD%86%E8%A8%98/%E7%AD%86%E8%A8%98-%E8%AA%8D%E8%AD%98-oauth-2-0-%E4%B8%80%E6%AC%A1%E4%BA%86%E8%A7%A3%E5%90%84%E8%A7%92%E8%89%B2-%E5%90%84%E9%A1%9E%E5%9E%8B%E6%B5%81%E7%A8%8B%E7%9A%84%E5%B7%AE%E7%95%B0-c42da83a6015">[Notes] Understanding OAuth 2.0: Understand the differences of each role and each type of process at one time</a></li>
<li><a href="https://blog.techbridge.cc/2019/02/01/linux-curl-command-tutorial/">https://blog.techbridge.cc/2019/02/01/linux-curl-command-tutorial/</a></li>
<li><a href="https://github.com/free5gc/free5gc/issues/434">https://github.com/free5gc/free5gc/issues/434</a></li>
</ul>
<h2 id="about">About</h2>
<p>Hi, my name is Wilson. I am a master’s student. My main area of research is network slicing. In the future, I will introduce more information about 5G. Hope you enjoy it.</p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © free5GC a Series of LF Projects, LLC.
For web site terms of use, trademark policy and other project policies please see https://lfprojects.org.

    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/u/free5gc" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/free5gc/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.facebook.com/profile.php?id=100086840296930" target="_blank" rel="noopener" title="www.facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.6eac0284.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>