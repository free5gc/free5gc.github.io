
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/icon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.3">
    
    
      
        <title>Unit test in free5GC's Network Function - free5GC</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.79e020e9.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a5377069.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unit-test-in-free5gcs-network-function" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="free5GC" class="md-header__button md-logo" aria-label="free5GC" data-md-component="logo">
      
  <img src="../../../assets/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            free5GC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Unit test in free5GC's Network Function
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/free5gc/free5gc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    free5GC
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../guide/" class="md-tabs__link">
        
  
    
  
  User Guide

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../doc/" class="md-tabs__link">
        
  
    
  
  Documents

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/free5gc/free5GLab" class="md-tabs__link">
        
  
    
  
  Tutorials

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
    
  
  Blogs

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../support/" class="md-tabs__link">
        
  
    
  
  Supports

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../publication/" class="md-tabs__link">
          
  
    
  
  More

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="free5GC" class="md-nav__button md-logo" aria-label="free5GC" data-md-component="logo">
      
  <img src="../../../assets/icon.png" alt="logo">

    </a>
    free5GC
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/free5gc/free5gc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    free5GC
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documents
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/free5gc/free5GLab" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blogs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supports
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    More
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            More
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../publication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relavent Publications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../videos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Other Videos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#i-how-to-write-a-go-test-program" class="md-nav__link">
    I. How to write a Go test program
  </a>
  
    <nav class="md-nav" aria-label="I. How to write a Go test program">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flags-you-might-use" class="md-nav__link">
    Flags you might use:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ii-test-example-in-amf-create-ue-context" class="md-nav__link">
    II. Test Example in AMF: Create UE Context
  </a>
  
    <nav class="md-nav" aria-label="II. Test Example in AMF: Create UE Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-test-setup-and-configuration" class="md-nav__link">
    1. Test Setup and Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-constructing-the-createuecontextrequest" class="md-nav__link">
    2. Constructing the CreateUeContextRequest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-the-core-test-testhandlecreateuecontextrequest" class="md-nav__link">
    3. The Core Test: TestHandleCreateUEContextRequest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3a-test-cases" class="md-nav__link">
    3a. Test Cases
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3b-mocking-the-amf-application-interface" class="md-nav__link">
    3b. Mocking the AMF Application Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3c-invoking-the-processor-and-verifying-the-response" class="md-nav__link">
    3c. Invoking the Processor and Verifying the Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-result" class="md-nav__link">
    4. Result
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii-conclusion" class="md-nav__link">
    III. Conclusion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iv-reference" class="md-nav__link">
    IV. Reference
  </a>
  
    <nav class="md-nav" aria-label="IV. Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#about" class="md-nav__link">
    About
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/free5gc/free5gc.github.io/blob/main/docs/blog/20250419/20250419.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/free5gc/free5gc.github.io/raw/main/docs/blog/20250419/20250419.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="unit-test-in-free5gcs-network-function">Unit test in free5GC's Network Function</h1>
<p>In the Go programming language, testing is an essential part of writing reliable and maintainable software. Go provides a built-in tool called go test that makes it easy to write and run automated tests. This tool helps developers ensure that their code behaves as expected, catch bugs early, and make future changes with confidence.</p>
<hr />
<h2 id="i-how-to-write-a-go-test-program">I. How to write a Go test program</h2>
<p>Here's a quick breakdown:</p>
<ol>
<li><strong>Test files</strong>: Named with <code>_test.go</code> suffix (e.g., <code>math_test.go</code>)</li>
<li><strong>Test functions</strong>: Start with <code>Test</code> and take a <code>*testing.T</code> as a parameter (e.g., <code>func TestAdd(t *testing.T)</code>)</li>
<li><strong>Command</strong>: Execute <code>go test</code>. (e.g., <code>go test math_test.go</code>)</li>
</ol>
<h3 id="example">Example</h3>
<p><strong>math.go</strong><br />
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>math_test.go</strong><br />
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;testing&quot;</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestAdd</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Expected 5, but got %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Then you'd run:</p>
<div class="highlight"><pre><span></span><code>go<span class="w"> </span><span class="nb">test</span>
</code></pre></div>
<p>And you'll see output like:</p>
<div class="highlight"><pre><span></span><code>PASS
ok      your/module/path    0.001s
</code></pre></div>
<h3 id="flags-you-might-use">Flags you might use:</h3>
<ul>
<li><code>go test -v</code>: Verbose output</li>
<li><code>go test ./...</code>: Test all packages recursively</li>
<li><code>go test -cover</code>: Show code coverage</li>
<li><code>go test -run=TestAdd</code>: Run only a specific test</li>
<li><code>go test -count=1</code>: Run the test again without test-cache, in order to run the test without getting the old result cache.</li>
<li><code>go test -race</code>: Run the test with a built-in Data Race Detector.</li>
<li><code>go test -p &lt;n&gt;</code>: Specify the number <code>&lt;n&gt;</code> of programs that can be run in parallel.</li>
</ul>
<hr />
<h2 id="ii-test-example-in-amf-create-ue-context">II. Test Example in AMF: Create UE Context</h2>
<ul>
<li><strong>Purpose:</strong> Verify that the AMF’s SBI‐processor correctly handles a UE Context creation request that includes a binary NGAP “Handover Required” message.</li>
<li><strong>Key Techniques:</strong></li>
<li><strong>Dependency injection</strong> of config and context (<code>initAMFConfig</code>).</li>
<li><strong>Mocking</strong> the AMF app interface with GoMock to intercept service calls.</li>
<li>Using <strong>Gin’s</strong> testing utilities (<code>httptest.NewRecorder()</code>, <code>gin.CreateTestContext</code>) to simulate HTTP requests.</li>
<li><strong>Testify</strong> for concise assertions.</li>
</ul>
<p>Here’s a breakdown of what’s happening in <strong>createUeContext_test.go</strong>:</p>
<h3 id="1-test-setup-and-configuration">1. Test Setup and Configuration</h3>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">testConfig</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">factory</span><span class="p">.</span><span class="nx">Config</span><span class="p">{</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">initAMFConfig</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">factory</span><span class="p">.</span><span class="nx">AmfConfig</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">testConfig</span>
<span class="w">    </span><span class="nx">amfContext</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">amf_context</span><span class="p">.</span><span class="nx">GetSelf</span><span class="p">()</span>
<span class="w">    </span><span class="nx">amf_context</span><span class="p">.</span><span class="nx">InitAmfContext</span><span class="p">(</span><span class="nx">amfContext</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><strong><code>testConfig</code></strong> defines an in‑memory AMF configuration (copied from <code>amfcfg.yaml</code>) with PLMN IDs, supported slices, timers, NGAP/SBI endpoints, etc.</li>
<li><strong><code>initAMFConfig()</code></strong> injects this config into the global <code>factory.AmfConfig</code> and initializes the AMF context so that all subsequent calls see a fully‑formed AMF state.</li>
</ul>
<h3 id="2-constructing-the-createuecontextrequest">2. Constructing the CreateUeContextRequest</h3>
<div class="highlight"><pre><span></span><code><span class="nx">CreateUeContextRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">CreateUeContextRequest</span><span class="p">{</span>
<span class="w">    </span><span class="nx">JsonData</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">models</span><span class="p">.</span><span class="nx">UeContextCreateData</span><span class="p">{</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">BinaryDataN2Information</span><span class="p">:</span><span class="w"> </span><span class="nx">buildHandoverRequiredNGAPBinaryData</span><span class="p">(),</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><strong><code>JsonData</code></strong> holds the UE’s SUPI, security capabilities, target RAN node ID, TAI, and a placeholder pointing to the binary N2 info (<code>Content‑Id: N2SmInfo</code>).  </li>
<li><strong><code>BinaryDataN2Information</code></strong> carries the actual NGAP handover‐required message as bytes, generated by  <code>buildHandoverRequiredTransfer()</code>, <code>buildSourceToTargetTransparentTransfer(targetGNBID, targetCellID)</code>, and <code>buildHandoverRequiredNGAPBinaryData()</code>.</li>
</ul>
<h3 id="3-the-core-test-testhandlecreateuecontextrequest">3. The Core Test: <code>TestHandleCreateUEContextRequest</code></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestHandleCreateUEContextRequest</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">openapi</span><span class="p">.</span><span class="nx">InterceptH2CClient</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">openapi</span><span class="p">.</span><span class="nx">RestoreH2CClient</span><span class="p">()</span>
<span class="w">    </span><span class="nx">initAMFConfig</span><span class="p">()</span>
</code></pre></div>
<ul>
<li><strong><code>openapi.InterceptH2CClient()</code></strong> swaps in a testing HTTP client so that when the processor makes SBI (Service-Based Interface) calls, they go through the mock rather than real network.</li>
<li>We call <strong><code>initAMFConfig()</code></strong> to ensure AMF context is ready.</li>
</ul>
<h3 id="3a-test-cases">3a. Test Cases</h3>
<div class="highlight"><pre><span></span><code><span class="nx">testCases</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">testDescription</span><span class="w">   </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">resultDescription</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">request</span><span class="w">           </span><span class="nx">models</span><span class="p">.</span><span class="nx">CreateUeContextRequest</span>
<span class="w">    </span><span class="nx">responseBody</span><span class="w">      </span><span class="kt">any</span>
<span class="w">    </span><span class="nx">expectedHTTPResp</span><span class="w">  </span><span class="o">*</span><span class="nx">httpwrapper</span><span class="p">.</span><span class="nx">Response</span>
<span class="p">}{</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nx">testDescription</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Valid Request&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">resultDescription</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">request</span><span class="p">:</span><span class="w">         </span><span class="nx">CreateUeContextRequest</span><span class="p">,</span>
<span class="w">        </span><span class="nx">responseBody</span><span class="p">:</span><span class="w">      </span><span class="o">&amp;</span><span class="nx">models</span><span class="p">.</span><span class="nx">CreateUeContextResponse201</span><span class="p">{},</span>
<span class="w">        </span><span class="nx">expectedHTTPResp</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">httpwrapper</span><span class="p">.</span><span class="nx">Response</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Status</span><span class="p">:</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Body</span><span class="p">:</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">CreateUeContextResponse201</span><span class="p">{</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Only one case: a valid request should produce HTTP <strong>201 Created</strong> and return a minimal <code>CreateUeContextResponse201</code> with the same SUPI and PDU session list.</li>
<li>Note that the response body is established to receive the response generated by the tested function.</li>
</ul>
<h3 id="3b-mocking-the-amf-application-interface">3b. Mocking the AMF Application Interface</h3>
<div class="highlight"><pre><span></span><code><span class="nx">mockAMF</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">NewMockAmfAppInterface</span><span class="p">(</span><span class="nx">gomock</span><span class="p">.</span><span class="nx">NewController</span><span class="p">(</span><span class="nx">t</span><span class="p">))</span>
<span class="nx">consumer</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">consumer</span><span class="p">.</span><span class="nx">NewConsumer</span><span class="p">(</span><span class="nx">mockAMF</span><span class="p">)</span>
<span class="nx">processor</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">processor</span><span class="p">.</span><span class="nx">NewProcessor</span><span class="p">(</span><span class="nx">mockAMF</span><span class="p">)</span>
<span class="nx">service</span><span class="p">.</span><span class="nx">AMF</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">mockAMF</span>

<span class="nx">mockAMF</span><span class="p">.</span><span class="nx">EXPECT</span><span class="p">().</span><span class="nx">Context</span><span class="p">().</span><span class="nx">Return</span><span class="p">(</span><span class="nx">amf_context</span><span class="p">.</span><span class="nx">GetSelf</span><span class="p">()).</span><span class="nx">AnyTimes</span><span class="p">()</span>
<span class="nx">mockAMF</span><span class="p">.</span><span class="nx">EXPECT</span><span class="p">().</span><span class="nx">Consumer</span><span class="p">().</span><span class="nx">Return</span><span class="p">(</span><span class="nx">consumer</span><span class="p">).</span><span class="nx">AnyTimes</span><span class="p">()</span>
</code></pre></div>
<ul>
<li>A <strong>GoMock</strong>‐generated <code>mockAMF</code> stands in for the real AMF app, so we can intercept calls during <code>HandleCreateUEContextRequest</code>.  </li>
<li>We tell it to always return our initialized context and consumer whenever <code>.Context()</code> or <code>.Consumer()</code> is called</li>
</ul>
<h3 id="3c-invoking-the-processor-and-verifying-the-response">3c. Invoking the Processor and Verifying the Response</h3>
<div class="highlight"><pre><span></span><code><span class="nx">processor</span><span class="p">.</span><span class="nx">HandleCreateUEContextRequest</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">tc</span><span class="p">.</span><span class="nx">request</span><span class="p">)</span>

<span class="nx">httpResp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">httpRecorder</span><span class="p">.</span><span class="nx">Result</span><span class="p">()</span>
<span class="nx">rawBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">httpResp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<span class="nx">openapi</span><span class="p">.</span><span class="nx">Deserialize</span><span class="p">(</span><span class="nx">tc</span><span class="p">.</span><span class="nx">responseBody</span><span class="p">,</span><span class="w"> </span><span class="nx">rawBytes</span><span class="p">,</span><span class="w"> </span><span class="err">…</span><span class="p">)</span>

<span class="nx">require</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">tc</span><span class="p">.</span><span class="nx">expectedHTTPResp</span><span class="p">.</span><span class="nx">Status</span><span class="p">,</span><span class="w"> </span><span class="nx">httpResp</span><span class="p">.</span><span class="nx">StatusCode</span><span class="p">)</span>
<span class="nx">require</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">expectedBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">respBytes</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>A Gin test context (<code>c</code>) captures the HTTP request and response.  </li>
<li>We call <code>HandleCreateUEContextRequest</code>, then read back the HTTP status and body, deserialize into the expected model, and assert equality using <strong>Testify’s</strong> <code>require.Equal</code>.</li>
</ul>
<h3 id="4-result">4. Result</h3>
<p><img alt="result.png" src="../result.png" /></p>
<p>Overall, the test examines that JSON + binary N2SM input to <code>HandleCreateUEContextRequest</code> yields the correct HTTP response under controlled, in‑memory conditions.</p>
<p>For more details, please visit test file under AMF with this path: amf/internal/sbi/processor/createUeContext_test.go.</p>
<hr />
<h2 id="iii-conclusion">III. Conclusion</h2>
<p>Testing helps keep free5GC reliable and easy to maintain. Using Go’s built-in tools along with GoMock, Gin, and Testify, developers can check if important parts, like UE context creation, work correctly. The example shows how to test with both JSON and binary data in a safe, in-memory setup. This makes it easier to find bugs, improve code quality, and build better software. With good testing, free5GC becomes a stronger and more ready-to-use 5G core system.</p>
<hr />
<h2 id="iv-reference">IV. Reference</h2>
<ul>
<li><a href="https://willh.gitbook.io/build-web-application-with-golang-zhtw/11.0/11.3">Go 怎麼寫測試案例</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers">HTTP headers</a></li>
<li><a href="https://canopas.com/golang-unit-tests-with-test-gin-context-80e1ac04adcd">Golang: Unit tests with test gin context</a></li>
<li><a href="https://vocus.cc/article/65095f2efd897800019852f4">如何在Go 中處理JSON</a></li>
<li><a href="https://go.dev/doc/articles/race_detector">Data Race Detector - The Go Programming Language</a></li>
<li><a href="https://pkg.go.dev/cmd/go#hdr-Compile_packages_and_dependencies">go command #Compile packages and dependencies</a></li>
</ul>
<hr />
<h3 id="about">About</h3>
<p>Hi, my name is Jeff Chen, I'm a newcommer of 5G core network.  My current focus is on developing AMF. If you notice any errors in this article, please reach out via Github! </p>
<p><a href="https://github.com/InertGas01">My GitHub link</a></p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © free5GC a Series of LF Projects, LLC.
For web site terms of use, trademark policy and other project policies please see https://lfprojects.org.

    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/u/free5gc" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/free5gc/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.facebook.com/profile.php?id=100086840296930" target="_blank" rel="noopener" title="www.facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.6eac0284.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>