
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/icon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.3">
    
    
      
        <title>A Practical Guide to Network Slicing and Traffic Steering with free5GC and OAI-MEC - free5GC</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.79e020e9.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a5377069.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#a-practical-guide-to-network-slicing-and-traffic-steering-with-free5gc-and-oai-mec" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="free5GC" class="md-header__button md-logo" aria-label="free5GC" data-md-component="logo">
      
  <img src="../../../assets/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            free5GC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              A Practical Guide to Network Slicing and Traffic Steering with free5GC and OAI-MEC
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/free5gc/free5gc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    free5GC
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../guide/" class="md-tabs__link">
        
  
    
  
  User Guide

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../doc/" class="md-tabs__link">
        
  
    
  
  Documents

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/free5gc/free5GLab" class="md-tabs__link">
        
  
    
  
  Tutorials

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
    
  
  Blogs

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../support/" class="md-tabs__link">
        
  
    
  
  Supports

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../publication/" class="md-tabs__link">
          
  
    
  
  More

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="free5GC" class="md-nav__button md-logo" aria-label="free5GC" data-md-component="logo">
      
  <img src="../../../assets/icon.png" alt="logo">

    </a>
    free5GC
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/free5gc/free5gc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    free5GC
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documents
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/free5gc/free5GLab" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blogs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supports
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    More
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            More
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../publication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relavent Publications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../videos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Other Videos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/free5gc/free5gc.github.io/blob/main/docs/blog/20250625/20250625.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/free5gc/free5gc.github.io/raw/main/docs/blog/20250625/20250625.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="a-practical-guide-to-network-slicing-and-traffic-steering-with-free5gc-and-oai-mec">A Practical Guide to Network Slicing and Traffic Steering with free5GC and OAI-MEC</h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Author: Fang-Kai Ting<br />
Date: 2025/07/03</p>
</div>
<hr />
<p>This guide provides a step-by-step walkthrough for implementing advanced 5G features on a free5GC deployment. It demonstrates how to configure <strong>OAI-MEC</strong>, create multiple <strong>network slices</strong>, and manage data paths using <strong>traffic steering</strong> with an Application Function (AF), culminating in a multi-slice, multi-MEC application architecture.</p>
<p><strong>Acknowledgements</strong></p>
<p>Special thanks to <a href="https://github.com/wilson30139"><strong>wilson30139</strong></a> for providing many of the configuration files used in this lab. This article would not have been possible without his contributions.</p>
<h1 id="intro">Intro</h1>
<p>In a previous article, we described an architecture where the UPF is deployed on an edge node, with the rest of the core network functions residing on a central core node. We then ran a ping test using a local UE to validate the setup.</p>
<p>This time, we will build upon that foundation by using the network slicing and traffic steering capabilities of the free5GC core. We will deploy a cluster containing two network slices. Each slice will have its own dedicated UPF and a simple Multi-access Edge Computing (MEC) application on the edge node. The main core network will host the other NFs and an identical application. This setup simulates a scenario where users in each network slice have a dedicated data plane and a specialized MEC application.</p>
<p>For the detailed VM configuration, please refer to the previous article. All VM and cluster settings for this tutorial will remain the same.</p>
<p><a href="https://free5gc.org/blog/20250416/20250416/">Optimizing free5GC Through Local UE Traffic and Dedicated UPF: A Multi-Node Helm Deployment Approach - free5GC</a></p>
<p><strong>It's important to note that we are using free5GC <code>v3.4.5</code>, because <code>v4.0.0</code> does not support traffic steering for the NEF (Network Exposure Function).</strong></p>
<p>The diagram below illustrates the final architecture. This article will guide you through three experiments to build this setup step-by-step.</p>
<p><img alt="image.png" src="../image.png" /></p>
<h2 id="lab-outline">Lab outline</h2>
<p><strong>Part 1: OAI-MEC Installation</strong><br />
Base on previous article structure, add the MEC Platform (MEP) and a MEC application, and then complete a basic ping test to verify the setup.</p>
<p><strong>Part 2: OAI-MEC App with Traffic Steering</strong><br />
Integrate the OpenNESS Application Function (AF). Then, use the AF and the Network Exposure Function (NEF) to send new packet routing rules to the network.</p>
<p><strong>Part 3: Two Slices with Two MEC Apps and Traffic Steering</strong><br />
Create and deploy two network slices. Next, use the MEP's gateway and registry mechanisms to enable service discovery for the MEC applications. Finally, apply traffic steering to achieve independent traffic control for each of the two slices.</p>
<p>Each of the three experiments will cover the following sections:</p>
<ol>
<li><strong>Architecture</strong></li>
<li><strong>Tools Introduction</strong></li>
<li><strong>Implementation and Configuration</strong></li>
<li><strong>Execution Commands and Results</strong></li>
</ol>
<h1 id="lab-1-installing-the-oai-mec-platform">Lab 1: Installing the OAI-MEC Platform</h1>
<h2 id="architecture"><strong>Architecture</strong></h2>
<p>Lab 1 will begin by deploying a MEC application on the edge node. We will then modify the UPF configuration to allow the UE (User Equipment) to route traffic to the external network via the <code>uesimtun0</code> interface, and also to direct traffic to the MEC application.<br />
We will use the OAI-MEC platform, available at <a href="https://gitlab.eurecom.fr/oai/orchestration/oai-mec/oai-mep">OAI MEP repo</a>. In the diagram, the green component represents the MEP (Multi-access Edge Computing Platform), which manages the entire lifecycle of the MEC application.</p>
<p><img alt="image.png" src="../image%201.png" /></p>
<h2 id="tools-introduction"><strong>Tools Introduction</strong></h2>
<h3 id="oai-mec">OAI-MEC</h3>
<p>OAI-MEC is a project under the OpenAirInterface (OAI) banner that focuses on developing an open-source Multi-access Edge Computing (MEC) platform. It is designed to be compliant with the European Telecommunications Standards Institute (ETSI) MEC standards.</p>
<p>The project provides key components like the MEC Platform (MEP) and a Radio Network Information Service (RNIS), enabling the deployment and management of edge applications. By integrating with OAI's 5G core and Radio Access Network (RAN), OAI-MEC allows developers and researchers to explore, test, and innovate on low-latency applications and services at the network edge, which is crucial for 5G use cases.</p>
<ul>
<li><strong>OAI MEP registry</strong><br />
This component tells the <strong>OAI MEP gateway</strong> where to find registered MEC applications and services.</li>
<li><strong>OAI MEP registry DB</strong><br />
This database stores the service information that the <strong>OAI MEP registry</strong> relies on to function.</li>
<li><strong>OAI MEP gateway</strong><br />
It receives API requests, asks the <strong>OAI MEP registry</strong> for the correct service location, and then forwards the request accordingly. It reads its own rules from the <strong>OAI MEP gateway DB</strong>.</li>
<li><strong>OAI MEP gateway DB</strong><br />
This database holds the configuration rules that the <strong>OAI MEP gateway</strong> uses to manage and route traffic.</li>
<li><strong>OAI kong migration</strong><br />
This is a process used to update the configuration data within the <strong>OAI MEP gateway DB</strong>, which in turn changes the behavior of the <strong>OAI MEP gateway</strong>.</li>
</ul>
<h2 id="implementation-and-configuration"><strong>Implementation and Configuration</strong></h2>
<p>Place <code>oai-mec</code> and <code>oai-mep</code> under the <code>free5GC-helm/charts</code> directory as shown in the diagram.</p>
<p>The <code>oai-mep</code> and <code>oai-mec-app</code> are configuration files provided by <a href="https://github.com/wilson30139">wilson30139</a>, which are modified from the original files at <a href="https://www.google.com/search?q=https://gitlab.com/oai/orchestration/oai-mec/oai-mep/-/tree/master&amp;authuser=1">OAI GitLab</a>.</p>
<p>The original files can be found at this commit: <a href="https://github.com/qawl987/free5gc-helm/commit/9d0946493f338c2ab45248c37c232585445dc6ee">MEP and MEC app file</a>. You can copy and modify them as needed.</p>
<p>For detailed reference on IP address modifications and other changes, see this commit: <a href="https://github.com/qawl987/free5gc-helm/commit/9474c99fbecbf4a6990fcef50bede20022d33011">MEP and MEC app modification</a>.</p>
<div class="highlight"><pre><span></span><code>├── charts
│   ├── app
│   ├── free5gc-amf
...
│   ├── free5gc-webui
│   ├── oai-mec-app
                ├── charts
                ├── Chart.yaml
                ├── templates
                │   ├── _helpers.tpl
                │   ├── mec-app-1
                │   │   ├── mec-app-1-configmap.yaml
                │   │   ├── mec-app-1-deployment.yaml
                │   │   ├── mec-app-1-nad.yaml
                │   │   └── mec-app-1-service.yaml
                │   └── NOTES.txt
                └── values.yaml
│   ├── oai-mep
                ├── charts
                ├── Chart.yaml
                ├── templates
                │   ├── _helpers.tpl
                │   ├── kong-migration
                │   │   ├── kong-migration-job.yaml
                │   │   └── kong-migration-nad.yaml
                │   ├── mep-gateway
                │   │   ├── mep-gateway-deployment.yaml
                │   │   ├── mep-gateway-nad.yaml
                │   │   └── mep-gateway-service.yaml
                │   ├── mep-gateway-db
                │   │   ├── mep-gateway-db-deployment.yaml
                │   │   ├── mep-gateway-db-nad.yaml
                │   │   └── mep-gateway-db-service.yaml
                │   ├── mep-registry
                │   │   ├── mep-registry-deployment.yaml
                │   │   ├── mep-registry-nad.yaml
                │   │   └── mep-registry-service.yaml
                │   ├── mep-registry-db
                │   │   ├── mep-registry-db-deployment.yaml
                │   │   ├── mep-registry-db-nad.yaml
                │   │   └── mep-registry-db-service.yaml
                │   └── NOTES.txt
                └── values.yaml
│   └── openness-af
</code></pre></div>
<ol>
<li>
<p>Modify all YAML configuration files for the MEP and MEC app.</p>
<p>This includes, but is not limited to, updating the settings for the following components within the MEP:</p>
<ul>
<li>MEP gateway DB IP address</li>
<li>MEP registry DB IP address</li>
<li>kong-migration service</li>
<li>MEP gateway IP address</li>
<li>MEP registry IP address</li>
<li>MEC app IP address</li>
<li>Edge node name</li>
<li>NAT network interface card name</li>
<li>NAT network interface card</li>
</ul>
<p>An example of the required IP address modifications is shown in the figure below.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>IP Address</th>
</tr>
</thead>
<tbody>
<tr>
<td>OAI MEP Gateway DB</td>
<td>10.0.2.3</td>
</tr>
<tr>
<td>OAI MEP Registry DB</td>
<td>10.0.2.4</td>
</tr>
<tr>
<td>OAI Kong Migration</td>
<td>10.0.2.5</td>
</tr>
<tr>
<td>OAI MEP Gateway</td>
<td>10.0.2.6</td>
</tr>
<tr>
<td>OAI MEP Registry</td>
<td>10.0.2.7</td>
</tr>
<tr>
<td>OAI MEC App 1</td>
<td>10.0.2.105</td>
</tr>
<tr>
<td>2. Modify the UPFb and UPF1 configurations.</td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="c1"># file path: charts/free5gc/charts/free5gc-upf/templates/upf1/upf1-configmap.yaml</span>
iptables<span class="w"> </span>-A<span class="w"> </span>FORWARD<span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-A<span class="w"> </span>POSTROUTING<span class="w"> </span>-s<span class="w"> </span><span class="o">{{</span><span class="w"> </span>$.Values.global.uesubnet<span class="w"> </span><span class="o">}}</span><span class="w"> </span>-o<span class="w"> </span>n6<span class="w"> </span>-j<span class="w"> </span>MASQUERADE<span class="w"> </span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;1200 n6if&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/iproute2/rt_tables
ip<span class="w"> </span>rule<span class="w"> </span>add<span class="w"> </span>from<span class="w"> </span><span class="o">{{</span><span class="w"> </span>$.Values.global.uesubnet<span class="w"> </span><span class="o">}}</span><span class="w"> </span>to<span class="w"> </span><span class="m">10</span>.0.2.0/24<span class="w"> </span>lookup<span class="w"> </span>main<span class="w"> </span>prio<span class="w"> </span><span class="m">20000</span>
ip<span class="w"> </span>rule<span class="w"> </span>add<span class="w"> </span>from<span class="w"> </span><span class="o">{{</span><span class="w"> </span>$.Values.global.uesubnet<span class="w"> </span><span class="o">}}</span><span class="w"> </span>table<span class="w"> </span>n6if<span class="w"> </span>prio<span class="w"> </span><span class="m">25000</span>
ip<span class="w"> </span>route<span class="w"> </span>add<span class="w"> </span>default<span class="w"> </span>via<span class="w"> </span><span class="o">{{</span><span class="w"> </span>$.Values.global.n6network.gatewayIP<span class="w"> </span><span class="o">}}</span><span class="w"> </span>dev<span class="w"> </span>n6<span class="w"> </span>table<span class="w"> </span>n6if
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># file path: charts/free5gc/charts/free5gc-upf/templates/upfb/upfb-configmap.yaml</span>
iptables<span class="w"> </span>-A<span class="w"> </span>FORWARD<span class="w"> </span>-j<span class="w"> </span>ACCEPT
iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-A<span class="w"> </span>POSTROUTING<span class="w"> </span>-s<span class="w"> </span><span class="o">{{</span><span class="w"> </span>$.Values.global.uesubnet<span class="w"> </span><span class="o">}}</span><span class="w"> </span>-o<span class="w"> </span>n6<span class="w"> </span>-j<span class="w"> </span>MASQUERADE<span class="w">  </span><span class="c1"># Allow routing traffic comming from the UE SUBNET to the interface N6</span>
iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-A<span class="w"> </span>POSTROUTING<span class="w"> </span>-o<span class="w"> </span>n9<span class="w"> </span>-j<span class="w"> </span>MASQUERADE
iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-A<span class="w"> </span>POSTROUTING<span class="w"> </span>-o<span class="w"> </span>n3<span class="w"> </span>-j<span class="w"> </span>MASQUERADE
ip<span class="w"> </span>rule<span class="w"> </span>add<span class="w"> </span>from<span class="w"> </span><span class="o">{{</span><span class="w"> </span>$.Values.global.uesubnet<span class="w"> </span><span class="o">}}</span><span class="w"> </span>to<span class="w"> </span><span class="m">10</span>.0.2.0/24<span class="w"> </span>lookup<span class="w"> </span>main<span class="w"> </span>prio<span class="w"> </span><span class="m">20000</span>
</code></pre></div>
<p>When a UE pings the <code>MEC app</code>, the default UPF rule inspects the routing table of the N6 interface. However, the <code>n6if</code> routing table only contains a default route: <code>default via 10.0.2.2 dev n6</code>.</p>
<p>Therefore, a new rule must be added. This rule will ensure that when an IP packet originates from the <code>uesubnet</code> and is destined for the <code>10.0.2.0/24</code> network, the system will use the main routing tables of <code>upfb</code> and <code>upf1</code> to find the correct forwarding path to the <code>mec-app</code>.</p>
<div class="highlight"><pre><span></span><code>ip<span class="w"> </span>rule<span class="w"> </span>add<span class="w"> </span>from<span class="w"> </span><span class="o">{{</span><span class="w"> </span>$.Values.global.uesubnet<span class="w"> </span><span class="o">}}</span><span class="w"> </span>to<span class="w"> </span><span class="m">10</span>.0.2.0/24<span class="w"> </span>lookup<span class="w"> </span>main<span class="w"> </span>prio<span class="w"> </span><span class="m">20000</span>
ip<span class="w"> </span>rule<span class="w"> </span>add<span class="w"> </span>from<span class="w"> </span><span class="o">{{</span><span class="w"> </span>$.Values.global.uesubnet<span class="w"> </span><span class="o">}}</span><span class="w"> </span>table<span class="w"> </span>n6if<span class="w"> </span>prio<span class="w"> </span><span class="m">25000</span>
</code></pre></div>
</li>
</ol>
<h2 id="execution-commands-and-results"><strong>Execution Commands and Results</strong></h2>
<p>After the deployment is complete, you can ping the <code>MEC app</code> from the <code>uesimtun0</code> interface. The traffic will be routed through <code>upfb</code> and <code>upf1</code>.</p>
<p><img alt="image.png" src="../image%202.png" /></p>
<p><img alt="image.png" src="../image%203.png" /></p>
<h1 id="lab-2-traffic-steering">Lab 2: Traffic Steering</h1>
<h2 id="architecture_1"><strong>Architecture</strong></h2>
<p>In lab1, add a new <code>app</code> to the core network that is identical to the <code>MEC app</code>. Then, configure traffic steering to redirect traffic, which would normally be routed to this new core application, to the <code>MEC app</code> instead.</p>
<p>Since both the ping command and traffic steering rules operate based on the destination IP address, the core application and the <code>MEC app</code> must be assigned the same IP address. As a result, they can share the same Network Attachment Definition (NAD).</p>
<ol>
<li>
<p>After traffic steering: Branch UPF → Anchor UPF→<code>app1</code></p>
<p><img alt="image.png" src="../image%204.png" /></p>
</li>
<li>
<p>After traffic steering: Branch UPF → <code>mec-app1</code></p>
<p><img alt="image.png" src="../image%205.png" /></p>
</li>
</ol>
<h2 id="tools-introduction_1"><strong>Tools Introduction</strong></h2>
<h3 id="af">AF</h3>
<p>The Application Function (AF) is a crucial element in the 5G architecture that allows external applications to interact with the 5G core network. Its primary role is to influence network behavior based on application-specific requirements.</p>
<p>The AF provides information to the Policy Control Function (PCF) via the Network Exposure Function (NEF), enabling it to make informed decisions about Quality of Service (QoS) and traffic routing.</p>
<p>This allows the network to dynamically create and manage PDU sessions.</p>
<h2 id="implementation-and-configuration_1"><strong>Implementation and Configuration</strong></h2>
<h3 id="af_1"><strong>AF</strong></h3>
<p>This is not part of the official free5GC project, so you need to add the AF (Application Function) Image to the Edge Node separately.</p>
<ol>
<li><code>git clone [https://github.com/danielh1204/opennessAF.git](https://github.com/danielh1204/opennessAF.git)</code></li>
<li><code>cd opennessAF/af</code></li>
<li><code>docker build -t af .</code></li>
<li><code>docker save af:latest -o af.tar</code></li>
<li><code>docker tag af:latest localhost:32000/af:latest</code></li>
<li><code>docker push localhost:32000/af:latest</code><ol>
<li>This step uses the local registry feature of MicroK8s.</li>
<li><code>microk8s enable registry</code></li>
</ol>
</li>
</ol>
<p>The charts for <code>openness-af</code> are available in this commit: <a href="https://github.com/qawl987/free5gc-helm/commit/42ddf6b3b2232ae5694b424ea8891be8a059e189">OpenNESS af file</a>, and are also provided by <a href="https://github.com/wilson30139">wilson30139</a>. You can download and modify them.</p>
<p>For detailed configuration changes, please refer to this commit: <a href="https://github.com/qawl987/free5gc-helm/commit/1010fa2b778e10a9c3ade510b92104471bff9466">OpenNESS af modification</a>.</p>
<h3 id="app"><strong>App</strong></h3>
<p>Copy the <code>MEC app</code> folder and rename it to <code>app</code>. This will be the application deployed on the core network, serving as the initial target for traffic steering.</p>
<h3 id="ti_datajson"><strong>ti_data.json</strong></h3>
<p>This is the configuration file for traffic steering, which can be modified according to your specific requirements.</p>
<ol>
<li>dnn</li>
<li>dnai</li>
<li>
<p>flowdescription</p>
<div class="highlight"><pre><span></span><code><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;afServiceId&quot;</span>:<span class="w"> </span><span class="s2">&quot;Service1&quot;</span>,
<span class="w">    </span><span class="s2">&quot;dnn&quot;</span>:<span class="w"> </span><span class="s2">&quot;internet&quot;</span>,
<span class="w">    </span><span class="s2">&quot;snssai&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;sst&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">        </span><span class="s2">&quot;sd&quot;</span>:<span class="w"> </span><span class="s2">&quot;010203&quot;</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;anyUeInd&quot;</span>:<span class="w"> </span>true,
<span class="w">    </span><span class="s2">&quot;notificationDestination&quot;</span>:<span class="w"> </span><span class="s2">&quot;http://af:8000/test123&quot;</span>,
<span class="w">    </span><span class="s2">&quot;trafficFilters&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;flowId&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">            </span><span class="s2">&quot;flowDescriptions&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">                </span><span class="s2">&quot;permit out ip from 10.0.2.105 to [uesubnetip](ex:10.1.0.0/24)&quot;</span>
<span class="w">            </span><span class="o">]</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">]</span>,
<span class="w">    </span><span class="s2">&quot;trafficRoutes&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;dnai&quot;</span>:<span class="w"> </span><span class="s2">&quot;mec&quot;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div>
</li>
</ol>
<h2 id="execution-commands-and-results_1"><strong>Execution Commands and Results</strong></h2>
<h3 id="af-request-below-command-all-run-inside-af-pod"><strong>AF request (Below command all run inside AF pod)</strong></h3>
<ol>
<li><code>kubectl exec -it [AF Pod Name] -n free5gc -- sh</code></li>
<li><code>vim ti_data.json</code><ol>
<li>Paste the <code>ti_data.json</code> configuration from above. If needed, modify the <code>uesubnet</code> section to <code>10.1.0.0/24</code>.</li>
<li>If you cannot use <code>curl</code> or <code>vim</code> within the AF pod, simply add them to the installation command in the AF <code>Dockerfile</code>.</li>
</ol>
</li>
<li><code>curl -X POST -H "Content-Type: application/json" --data @./[File
Name] http://[NEF Service IP Address]/3gpp-traffic-
influence/v1/af001/subscriptions</code><ol>
<li>ex: <code>curl -X POST -H "Content-Type: application/json" --data @./ti_data.json [http://10.152.183.217:80/3gpp-traffic-influence/v1/af001/subscriptions](http://10.152.183.217/3gpp-traffic-influence/v1/af001/subscriptions)</code></li>
</ol>
</li>
</ol>
<h3 id="ping-test">Ping test</h3>
<ul>
<li>
<p>Before traffic steering:</p>
<ul>
<li>Left side: <code>upfb.n9</code> | Right side: <code>upf1.upfgtp</code></li>
<li>
<p><code>upfb.n9</code> → <code>upf1.upfgtp</code></p>
<p><img alt="image.png" src="../image%206.png" /></p>
</li>
</ul>
</li>
<li>
<p>After traffic steering:</p>
<ul>
<li>
<p><code>upfb.upfgtp</code></p>
<p><img alt="image.png" src="../image%207.png" /></p>
</li>
</ul>
</li>
</ul>
<h1 id="lab-3-two-slice-with-two-mec-app-with-traffic-steering">Lab 3: Two slice with two MEC-app with traffic steering</h1>
<ol>
<li><strong>Architecture</strong></li>
<li><strong>Tools Introduction</strong></li>
<li><strong>Implementation and Configuration</strong></li>
<li><strong>Execution Commands and Results</strong></li>
</ol>
<h2 id="architecture_2"><strong>Architecture</strong></h2>
<p>In Lab 3, you will need to use the web console to create two network slices. In the SMF and UPF configurations, you will then set up the traffic to route through its dedicated network slice. Finally, you will use traffic steering to control the traffic flow to the <code>MEC app</code>.</p>
<p><strong>First network slice (dedicated resources):</strong></p>
<ul>
<li>Branch UPF1</li>
<li>OAI MEC app 1</li>
<li>Anchor UPF1</li>
<li>app 1</li>
</ul>
<p><strong>Second network slice (dedicated resources):</strong></p>
<ul>
<li>Branch UPF2</li>
<li>OAI MEC app 2</li>
<li>Anchor UPF2</li>
<li>app 2</li>
</ul>
<p><strong>Shared Resources:</strong></p>
<ul>
<li>Core Network NFs</li>
<li>OAI-MEP</li>
<li>AF</li>
</ul>
<p><img alt="image.png" src="../image%208.png" /></p>
<p><img alt="image.png" src="../image%209.png" /></p>
<h2 id="tools-introduction_2"><strong>Tools Introduction</strong></h2>
<h3 id="network-slicing">Network Slicing</h3>
<p>In free5GC, different network slices are distinguished using identifiers such as the S-NSSAI (Single Network Slice Selection Assistance Information) and DNN (Data Network Name).</p>
<p>This allows each slice to be configured with its own dedicated UPF, making it possible to provide specialized services and guarantee specific QoS levels for each slice.</p>
<h2 id="implementation-and-configuration_2"><strong>Implementation and Configuration</strong></h2>
<h3 id="amf-smf-upf-config">AMF, SMF, UPF config</h3>
<p>Referring to the architecture diagram above, here are the UPF names and their corresponding interface IP addresses.</p>
<p>branch upf1: upfb</p>
<p>branch upf2: upfb2</p>
<p>anchor upf1: upf1</p>
<p>anchor upf2: upf2</p>
<table>
<thead>
<tr>
<th></th>
<th>upfb</th>
<th>upfb2</th>
<th>upf1</th>
<th>upf2</th>
</tr>
</thead>
<tbody>
<tr>
<td>N3</td>
<td>192.168.56.19</td>
<td>192.168.56.38</td>
<td>X</td>
<td>X</td>
</tr>
<tr>
<td>N4</td>
<td>10.100.50.241</td>
<td>10.100.50.242</td>
<td>10.100.50.243</td>
<td>10.100.50.245</td>
</tr>
<tr>
<td>N6</td>
<td>10.0.2.15</td>
<td>10.0.2.16</td>
<td>10.0.2.13</td>
<td>10.0.2.14</td>
</tr>
<tr>
<td>N9</td>
<td>10.100.50.225</td>
<td>10.100.50.226</td>
<td>10.100.50.227</td>
<td>10.100.50.228</td>
</tr>
</tbody>
</table>
<p>The detailed configuration file for the following can be found in <a href="https://github.com/qawl987/free5gc-helm/commit/8c4d4a0250d87cad473b559bd9221e0843810003">AMF, SMF, UPF modification</a></p>
<h3 id="amf">AMF</h3>
<p>Add <code>internet2</code> to the <code>supportDnnList</code>.</p>
<h3 id="smf">SMF</h3>
<p>Addition to <code>snssaiInfos</code></p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sNssai:Add commentMore actions</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">sst</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">sd</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">112233</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">dnnInfos</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="c1"># DNN information list</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dnn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">internet2</span><span class="w"> </span><span class="c1"># Data Network Name</span>
<span class="w">        </span><span class="nt">dnaiList</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mec2</span>
<span class="w">        </span><span class="nt">dns</span><span class="p">:</span><span class="w"> </span><span class="c1"># the IP address of DNS</span>
<span class="w">          </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8.8.8.8</span>
<span class="w">          </span><span class="nt">ipv6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2001:4860:4860::8888</span>
</code></pre></div>
<p>You need to configure <code>userplaneInformation</code> and <code>ueRoutingInfo</code> with the corresponding IP addresses and specify the specific paths for the two UEs.</p>
<h3 id="upf">UPF</h3>
<p>First, add a new UPF instance named <code>upfb2</code>.</p>
<p>Then, modify the Helm template file at <code>free5gc-upf/templates/_helpers.tpl</code> to update the configurations for all relevant UPF instances: <code>upf1</code>, <code>upf2</code>, <code>upfb</code>, and the new <code>upfb2</code>.</p>
<h3 id="create-a-new-network-slice">Create a new network slice</h3>
<ol>
<li>
<p>Based on the screenshots from the free5GC v3.4.5 web console below, we will create a network slice named <code>internet2</code>.</p>
<p><img alt="image.png" src="../image%2010.png" /></p>
<p><img alt="image.png" src="../image%2011.png" /></p>
<p><img alt="image.png" src="../image%2012.png" /></p>
<p><img alt="image.png" src="../image%2013.png" /></p>
<p><img alt="image.png" src="../image%2014.png" /></p>
<p><img alt="image.png" src="../image%2015.png" /></p>
<p><img alt="image.png" src="../image%2016.png" /></p>
</li>
</ol>
<h3 id="when-a-ue-uses-the-oai-mec-app-service">When a UE uses the OAI MEC App Service</h3>
<p>In the UE VM, edit the <code>/etc/hosts</code> file (e.g., <code>vim /etc/hosts</code>) and add the following line:</p>
<p><code>[OAI MEP Gateway IP Address] oai-mep.org</code></p>
<h3 id="use-the-local-mec-app-image">Use the local <code>MEC app</code> image</h3>
<p>The <code>MEC app</code> image often exceeds Docker's pull rate limits, causing the deployment to fail. Therefore, you need to build the image locally and push it to the MicroK8s local registry. You can find a reference for the Dockerfile at this commit: <a href="https://github.com/qawl987/free5gc-helm/commit/64b65d6ea226d033360cd2692e53249347757fcf">MEC app dockerfile</a>.</p>
<p>Modify the <code>mec-app-1-deployment.yaml</code> to use the image: <code>localhost:32000/mec-app1:v1</code>.</p>
<h3 id="ti_data2json">ti_data2.json</h3>
<p>The JSON file for UE2 traffic steering.</p>
<div class="highlight"><pre><span></span><code>{
    &quot;afServiceId&quot;: &quot;Service2&quot;,
    &quot;dnn&quot;: &quot;internet2&quot;,
    &quot;snssai&quot;: {
        &quot;sst&quot;: 1,
        &quot;sd&quot;: &quot;112233&quot;
    },
    &quot;anyUeInd&quot;: true,
    &quot;notificationDestination&quot;: &quot;http://af:8000/test123&quot;,
    &quot;trafficFilters&quot;: [
        {
            &quot;flowId&quot;: 2,
            &quot;flowDescriptions&quot;: [
                &quot;permit out ip from 10.0.2.107 to [uesubnetip]&quot;
            ]
        }
    ],
    &quot;trafficRoutes&quot;: [
        {
            &quot;dnai&quot;: &quot;mec2&quot;
        }
    ]
}
</code></pre></div>
<h2 id="execution-commands-and-results_2"><strong>Execution Commands and Results</strong></h2>
<h3 id="deployment-example">Deployment example</h3>
<p>The <code>MEC app</code> should have a 'Running' status. If it restarts repeatedly or gets stuck in a loop, it indicates a problem with the application.</p>
<p><img alt="image.png" src="../image%2017.png" /></p>
<h3 id="ping-test_1">Ping test</h3>
<p><img alt="image.png" src="../image%2018.png" /></p>
<p><img alt="image.png" src="../image%2019.png" /></p>
<p><code>curl --interface uesimtun0 [http://oai-mep.org:8002/first_mec_app/v1/second_web_page](http://oai-mep.org:8002/first_mec_app/v1/second_web_page)</code></p>
<p><code>curl --interface uesimtun1 [http://oai-mep.org:8002/second_mec_app/v1/second_web_page](http://oai-mep.org:8002/second_mec_app/v1/second_web_page)</code></p>
<h2 id="mec-app-e2e-test">Mec-app E2E test</h2>
<ol>
<li>
<p>Before traffic steering</p>
<ol>
<li>Using the MEP's gateway registry system to retrieve the <code>MEC app</code> content.</li>
<li>
<p><code>curl --interface uesimtun0 [http://oai-mep.org:8002/first_mec_app/v1/second_web_page](http://oai-mep.org:8002/first_mec_app/v1/second_web_page)</code></p>
<p><img alt="image.png" src="../image%2020.png" /></p>
</li>
<li>
<p><code>curl --interface uesimtun1 [http://oai-mep.org:8002/second_mec_app/v1/second_web_page](http://oai-mep.org:8002/second_mec_app/v1/second_web_page)</code></p>
<p><img alt="image.png" src="../image%2021.png" /></p>
</li>
<li>
<p>The following are the <code>tcpdump</code> results from each UPF. The N9 interface is on the left, and the <code>upfgtp</code> interface is on the right. As you can see, the traffic is still being routed from the branch UPF to the anchor UPF.</p>
<ol>
<li>
<p>upf1</p>
<p><img alt="image.png" src="../image%2022.png" /></p>
</li>
<li>
<p>upf2</p>
<p><img alt="image.png" src="../image%2023.png" /></p>
</li>
<li>
<p>upfb</p>
<p><img alt="image.png" src="../image%2024.png" /></p>
</li>
<li>
<p>upfb2</p>
<p><img alt="image.png" src="../image%2025.png" /></p>
</li>
</ol>
</li>
</ol>
</li>
<li>
<p>Traffic steering command</p>
<ol>
<li><code>curl -X POST -H "Content-Type: application/json" --data @./ti_data.json [http://10.152.183.217:80/3gpp-traffic-influence/v1/af001/subscriptions](http://10.152.183.217/3gpp-traffic-influence/v1/af001/subscriptions)</code></li>
<li><code>curl -X POST -H "Content-Type: application/json" --data @./ti_data2.json [http://10.152.183.217:80/3gpp-traffic-influence/v1/af001/subscriptions](http://10.152.183.217/3gpp-traffic-influence/v1/af001/subscriptions)</code></li>
</ol>
</li>
<li>
<p>After traffic steering</p>
<ol>
<li><code>curl --interface uesimtun0 [http://10.0.2.105/v1/second_web_page](http://10.0.2.105/v1/second_web_page)</code></li>
<li>
<p>The left side corresponds to the N9 interface, and the right side corresponds to the <code>upfgtp</code> interface.</p>
<p>After traffic steering is applied, the traffic is sent directly out from the <code>upfgtp</code> interface of the branch UPF.</p>
<ol>
<li>
<p>upf1</p>
<p><img alt="image.png" src="../image%2026.png" /></p>
</li>
<li>
<p>upfb</p>
<p><img alt="image.png" src="../image%2027.png" /></p>
</li>
</ol>
</li>
<li>
<p><code>curl --interface uesimtun1 [http://10.0.2.107/v1/second_web_page](http://10.0.2.107/v1/second_web_page)</code></p>
<ol>
<li>
<p>upf2</p>
<p><img alt="image.png" src="../image%2028.png" /></p>
</li>
<li>
<p>upfb2</p>
<p><img alt="image.png" src="../image%2029.png" /></p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h1 id="appendix">Appendix</h1>
<p>Here are some additional commands you can use to verify if the traffic steering was successful.</p>
<p><strong>UDR</strong></p>
<ol>
<li>
<p><code>curl -X GET -H "Content-Type: application/json" [http://10.152.183.38/nudr-dr/v1/application-data/influenceData?dnns=internet](http://10.152.183.38/nudr-dr/v1/application-data/influenceData?dnns=internet)</code></p>
<p><img alt="image.png" src="../image%2030.png" /></p>
<p><img alt="image.png" src="../image%2031.png" /></p>
</li>
</ol>
<p><strong>NEF</strong></p>
<ol>
<li>
<p>query command</p>
<ol>
<li>
<p><code>curl -X GET -H "Content-Type: application/json" [http://10.152.183.217/3gpp-traffic-influence/v1/af001/subscriptions?dnns=internet](http://10.152.183.217/3gpp-traffic-influence/v1/af001/subscriptions?dnns=internet)</code></p>
<p>self: The final number is the ID you will use for the delete operation.</p>
<p><img alt="image.png" src="../image%2032.png" /></p>
</li>
</ol>
</li>
<li>
<p>delete command</p>
<ol>
<li><code>curl -X DELETE -H "Content-Type: application/json" [http://10.152.183.217/3gpp-traffic-influence/v1/af001/subscriptions/2](http://10.152.183.217/3gpp-traffic-influence/v1/af001/subscriptions/2)</code></li>
</ol>
</li>
</ol>
<h1 id="conclusion">Conclusion</h1>
<p>This guide provides a step-by-step walkthrough for implementing advanced 5G features on a free5GC deployment. It demonstrates how to configure <strong>OAI-MEC</strong>, create multiple <strong>network slices</strong>, and manage data paths using <strong>traffic steering</strong> with an Application Function (AF), culminating in a multi-slice, multi-MEC application architecture.</p>
<h3 id="reference">Reference</h3>
<p><a href="https://gitlab.eurecom.fr/oai/orchestration/oai-mec/oai-mep">Files · master · oai / orchestration / oai-mec / oai-mep · GitLab</a></p>
<p>https://github.com/qawl987/free5gc-helm</p>
<h3 id="about-me"><strong>About me</strong></h3>
<p>Hi, I’m Fang-Kai Ting, a newcomer to 5G and free5GC, and currently conducting research on Network Slicing. Let me know without hesitation if there is any mistake in the article.</p>
<h2 id="connect-with-me">Connect with Me</h2>
<p>Github: <a href="https://github.com/qawl987">qawl987</a></p>
<p>Linkedin: <a href="http://www.linkedin.com/in/%E6%96%B9%E5%87%B1-%E4%B8%81-a26a7925a">www.linkedin.com/in/方凱-丁-a26a7925a</a></p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © free5GC a Series of LF Projects, LLC.
For web site terms of use, trademark policy and other project policies please see https://lfprojects.org.

    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/u/free5gc" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/free5gc/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.facebook.com/profile.php?id=100086840296930" target="_blank" rel="noopener" title="www.facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.6eac0284.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>