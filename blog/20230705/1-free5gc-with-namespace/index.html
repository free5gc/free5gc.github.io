
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/icon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.3">
    
    
      
        <title>1 free5gc with namespace - free5GC</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.79e020e9.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a5377069.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#use-network-namespace-to-separate-the-5g-core-5gc-and-ran-simulator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="free5GC" class="md-header__button md-logo" aria-label="free5GC" data-md-component="logo">
      
  <img src="../../../assets/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            free5GC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              1 free5gc with namespace
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/free5gc/free5gc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    free5GC
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../guide/" class="md-tabs__link">
        
  
    
  
  User Guide

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../doc/" class="md-tabs__link">
        
  
    
  
  Documents

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://training.linuxfoundation.org/training/introduction-to-free5gc-lfs114/" class="md-tabs__link">
        
  
    
  
  LFX Course

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/free5gc/free5GLab" class="md-tabs__link">
        
  
    
  
  Tutorials

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
    
  
  Blogs

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../support/" class="md-tabs__link">
        
  
    
  
  Supports

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../publication/" class="md-tabs__link">
          
  
    
  
  More

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="free5GC" class="md-nav__button md-logo" aria-label="free5GC" data-md-component="logo">
      
  <img src="../../../assets/icon.png" alt="logo">

    </a>
    free5GC
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/free5gc/free5gc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    free5GC
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documents
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="https://training.linuxfoundation.org/training/introduction-to-free5gc-lfs114/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LFX Course
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/free5gc/free5GLab" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blogs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supports
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    More
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            More
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../publication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relavent Publications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../videos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Other Videos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-file-of-free5gc-and-ueransim" class="md-nav__link">
    Configuration file of free5GC and UERANSIM
  </a>
  
    <nav class="md-nav" aria-label="Configuration file of free5GC and UERANSIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#free5gc" class="md-nav__link">
    free5GC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ueransim" class="md-nav__link">
    UERANSIM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-set-up-of-free5gc-and-ueransim" class="md-nav__link">
    Environment set up of free5GC and UERANSIM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-if-two-ueransims-with-two-namespaces" class="md-nav__link">
    What if two UERANSIMs with two namespaces?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about" class="md-nav__link">
    About
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    Reference
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/free5gc/free5gc.github.io/blob/main/docs/blog/20230705/1-free5gc-with-namespace.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/free5gc/free5gc.github.io/raw/main/docs/blog/20230705/1-free5gc-with-namespace.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JETJ7TJ805"></script>
<script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JETJ7TJ805'); </script>

<h1 id="use-network-namespace-to-separate-the-5g-core-5gc-and-ran-simulator">Use network namespace to separate the 5G core (5GC) and RAN simulator</h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Author: Jimmy Chang<br />
Date: 2023/7/5</p>
</div>
<h2 id="overview">Overview</h2>
<p>This technique leverages namespace to run <a href="https://github.com/aligungr/UERANSIM">UERANSIM</a>, an opensource 5G-UE and RAN(gNodeB) simulator, and connect to free5GC.<br />
UERANSIM follows the 3GPP specification for developing and can support multiple 5G core (5GC) including free5GC.</p>
<p>Why are we using namespace? Well, you can follow <a href="https://github.com/s5uishida/free5gc_ueransim_ulcl_sample_config">ULCL</a> and <a href="https://github.com/free5gc/free5gc-compose">free5GC compose</a> to set up the environment with VM and docker, but there are limitations for hardwareâ€™s capability. With network namespace, you can have different and separate network instances of network<br />
interfaces and routing tables that operate independently.</p>
<p>So, what is network namespace? Network namespace makes a copy of network stack with its own routing table, firewall and devices. A named network namespace is an object at <code>/var/run/netns/</code>. The file descriptor resulting from opening <code>/var/run/netns/</code> refers to the specified network namespace. Holding that file descriptor open<br />
keeps the network namespace alive.</p>
<p>And how to make both namespaces communicating? A virtual Ethernet device (veth) pair provides the abstraction that can be used to create tunnels between network namespaces, and can be used to create bridge to a physical network device in another namespace. Veth pair also be used as standalone network devices.<br />
When the namespace freed, veth device which attatch to would be destroyed.</p>
<p>The environment is as follow. Suppose you have already installed as well as set up <a href="https://free5gc.org/guide/#information">free5GC</a> and <a href="https://github.com/aligungr/UERANSIM/wiki/Installation">UERANSIM</a> properly.</p>
<ul>
<li>free5GC v3.3.0</li>
<li>UERANSIM v3.1.0</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>Namespace free5GC</em> represents host network namespace. And enp0s5 is an ethernet interface connectting to external.</p>
</div>
<p><img alt="" src="../1-1.png" /></p>
<div class="highlight"><pre><span></span><code>Each devices as follow
| Device        | IP             |
| ------------- | -------------  |
| veth0         | 10.200.200.1   |
| veth1         | 10.200.200.2   |
| br-veth0      | none           |
| br-veth1      | none           |
| enp0s5        | 10.211.55.23   |


UE information in UERANSIM as follow. Already
| IMSI             | DNN           |
| ---------------- | ------------- |
| 208930000000003  | internet      |
</code></pre></div>
<h2 id="configuration-file-of-free5gc-and-ueransim">Configuration file of free5GC and UERANSIM</h2>
<h3 id="free5gc">free5GC</h3>
<ul>
<li><strong>free5gc/config/amfcfg.yaml</strong></li>
</ul>
<p>Replace ngapIpList IP from <code>127.0.0.18</code> to <code>10.200.200.2</code>:</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">info</span><span class="p">:</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0.9</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AMF initial local configuration</span>

<span class="nt">configuration</span><span class="p">:</span>
<span class="w">  </span><span class="nt">amfName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AMF</span><span class="w"> </span><span class="c1"># the name of this AMF</span>
<span class="w">  </span><span class="nt">ngapIpList</span><span class="p">:</span><span class="w">  </span><span class="c1"># the IP list of N2 interfaces on this AMF</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.200.200.2</span><span class="w"> </span><span class="c1"># 127.0.0.18</span>
<span class="w">  </span><span class="nt">ngapPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">38412</span><span class="w"> </span><span class="c1"># the SCTP port listened by NGAP</span>
<span class="w">  </span><span class="nt">sbi</span><span class="p">:</span><span class="w"> </span><span class="c1"># Service-based interface information</span>
<span class="w">    </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"> </span><span class="c1"># the protocol for sbi (http or https)</span>
<span class="w">    </span><span class="nt">registerIPv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.18</span><span class="w"> </span><span class="c1"># IP used to register to NRF</span>
<span class="w">    </span><span class="nt">bindingIPv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.18</span><span class="w">  </span><span class="c1"># IP used to bind the service</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span><span class="w"> </span><span class="c1"># port used to bind the service</span>
<span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w"> </span><span class="c1"># the local path of TLS key</span>
<span class="w">      </span><span class="nt">pem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert/amf.pem</span><span class="w"> </span><span class="c1"># AMF TLS Certificate</span>
<span class="w">      </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert/amf.key</span><span class="w"> </span><span class="c1"># AMF TLS Private key</span>
<span class="w">  </span><span class="nt">serviceNameList</span><span class="p">:</span><span class="w"> </span><span class="c1"># the SBI services provided by this AMF, refer to TS 29.518</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namf-comm</span><span class="w"> </span><span class="c1"># Namf_Communication service</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namf-evts</span><span class="w"> </span><span class="c1"># Namf_EventExposure service</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namf-mt</span><span class="w">   </span><span class="c1"># Namf_MT service</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namf-loc</span><span class="w">  </span><span class="c1"># Namf_Location service</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namf-oam</span><span class="w">  </span><span class="c1"># OAM service</span>
<span class="w">  </span><span class="nt">servedGuamiList</span><span class="p">:</span><span class="w"> </span><span class="c1"># Guami (Globally Unique AMF ID) list supported by this AMF</span>
<span class="w">    </span><span class="c1"># &lt;GUAMI&gt; = &lt;MCC&gt;&lt;MNC&gt;&lt;AMF ID&gt;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">plmnId</span><span class="p">:</span><span class="w"> </span><span class="c1"># Public Land Mobile Network ID, &lt;PLMN ID&gt; = &lt;MCC&gt;&lt;MNC&gt;</span>
<span class="w">        </span><span class="nt">mcc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">208</span><span class="w"> </span><span class="c1"># Mobile Country Code (3 digits string, digit: 0~9)</span>
<span class="w">        </span><span class="nt">mnc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">93</span><span class="w"> </span><span class="c1"># Mobile Network Code (2 or 3 digits string, digit: 0~9)</span>
<span class="w">      </span><span class="nt">amfId</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cafe00</span><span class="w"> </span><span class="c1"># AMF identifier (3 bytes hex string, range: 000000~FFFFFF)</span>
<span class="w">  </span><span class="nt">supportTaiList</span><span class="p">:</span><span class="w">  </span><span class="c1"># the TAI (Tracking Area Identifier) list supported by this AMF</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">plmnId</span><span class="p">:</span><span class="w"> </span><span class="c1"># Public Land Mobile Network ID, &lt;PLMN ID&gt; = &lt;MCC&gt;&lt;MNC&gt;</span>
<span class="w">        </span><span class="nt">mcc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">208</span><span class="w"> </span><span class="c1"># Mobile Country Code (3 digits string, digit: 0~9)</span>
<span class="w">        </span><span class="nt">mnc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">93</span><span class="w"> </span><span class="c1"># Mobile Network Code (2 or 3 digits string, digit: 0~9)</span>
<span class="w">      </span><span class="nt">tac</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">000001</span><span class="w"> </span><span class="c1"># Tracking Area Code (3 bytes hex string, range: 000000~FFFFFF)</span>
<span class="w">  </span><span class="nt">plmnSupportList</span><span class="p">:</span><span class="w"> </span><span class="c1"># the PLMNs (Public land mobile network) list supported by this AMF</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">plmnId</span><span class="p">:</span><span class="w"> </span><span class="c1"># Public Land Mobile Network ID, &lt;PLMN ID&gt; = &lt;MCC&gt;&lt;MNC&gt;</span>
<span class="w">        </span><span class="nt">mcc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">208</span><span class="w"> </span><span class="c1"># Mobile Country Code (3 digits string, digit: 0~9)</span>
<span class="w">        </span><span class="nt">mnc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">93</span><span class="w"> </span><span class="c1"># Mobile Network Code (2 or 3 digits string, digit: 0~9)</span>
<span class="w">      </span><span class="nt">snssaiList</span><span class="p">:</span><span class="w"> </span><span class="c1"># the S-NSSAI (Single Network Slice Selection Assistance Information) list supported by this AMF</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># Slice/Service Type (uinteger, range: 0~255)</span>
<span class="w">          </span><span class="nt">sd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">010203</span><span class="w"> </span><span class="c1"># Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># Slice/Service Type (uinteger, range: 0~255)</span>
<span class="w">          </span><span class="nt">sd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">112233</span><span class="w"> </span><span class="c1"># Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)</span>
<span class="w">  </span><span class="nt">supportDnnList</span><span class="p">:</span><span class="w">  </span><span class="c1"># the DNN (Data Network Name) list supported by this AMF</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">internet</span>
<span class="w">  </span><span class="nt">nrfUri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://127.0.0.10:8000</span><span class="w"> </span><span class="c1"># a valid URI of NRF</span>
<span class="w">  </span><span class="nt">security</span><span class="p">:</span><span class="w">  </span><span class="c1"># NAS security parameters</span>
<span class="w">    </span><span class="nt">integrityOrder</span><span class="p">:</span><span class="w"> </span><span class="c1"># the priority of integrity algorithms</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NIA2</span>
<span class="w">      </span><span class="c1"># - NIA0</span>
<span class="w">    </span><span class="nt">cipheringOrder</span><span class="p">:</span><span class="w"> </span><span class="c1"># the priority of ciphering algorithms</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NEA0</span>
<span class="w">      </span><span class="c1"># - NEA2</span>
<span class="w">  </span><span class="nt">networkName</span><span class="p">:</span><span class="w">  </span><span class="c1"># the name of this core network</span>
<span class="w">    </span><span class="nt">full</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">free5GC</span>
<span class="w">    </span><span class="nt">short</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">free</span>
<span class="w">  </span><span class="nt">ngapIE</span><span class="p">:</span><span class="w"> </span><span class="c1"># Optional NGAP IEs</span>
<span class="w">    </span><span class="nt">mobilityRestrictionList</span><span class="p">:</span><span class="w"> </span><span class="c1"># Mobility Restriction List IE, refer to TS 38.413</span>
<span class="w">      </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># append this IE in related message or not</span>
<span class="w">    </span><span class="nt">maskedIMEISV</span><span class="p">:</span><span class="w"> </span><span class="c1"># Masked IMEISV IE, refer to TS 38.413</span>
<span class="w">      </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># append this IE in related message or not</span>
<span class="w">    </span><span class="nt">redirectionVoiceFallback</span><span class="p">:</span><span class="w"> </span><span class="c1"># Redirection Voice Fallback IE, refer to TS 38.413</span>
<span class="w">      </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"> </span><span class="c1"># append this IE in related message or not</span>
<span class="w">  </span><span class="nt">nasIE</span><span class="p">:</span><span class="w"> </span><span class="c1"># Optional NAS IEs</span>
<span class="w">    </span><span class="nt">networkFeatureSupport5GS</span><span class="p">:</span><span class="w"> </span><span class="c1"># 5gs Network Feature Support IE, refer to TS 24.501</span>
<span class="w">      </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># append this IE in Registration accept or not</span>
<span class="w">      </span><span class="nt">length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># IE content length (uinteger, range: 1~3)</span>
<span class="w">      </span><span class="nt">imsVoPS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># IMS voice over PS session indicator (uinteger, range: 0~1)</span>
<span class="w">      </span><span class="nt">emc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># Emergency service support indicator for 3GPP access (uinteger, range: 0~3)</span>
<span class="w">      </span><span class="nt">emf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># Emergency service fallback indicator for 3GPP access (uinteger, range: 0~3)</span>
<span class="w">      </span><span class="nt">iwkN26</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># Interworking without N26 interface indicator (uinteger, range: 0~1)</span>
<span class="w">      </span><span class="nt">mpsi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># MPS indicator (uinteger, range: 0~1)</span>
<span class="w">      </span><span class="nt">emcN3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># Emergency service support indicator for Non-3GPP access (uinteger, range: 0~1)</span>
<span class="w">      </span><span class="nt">mcsi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># MCS indicator (uinteger, range: 0~1)</span>
<span class="w">  </span><span class="nt">t3502Value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">720</span><span class="w">  </span><span class="c1"># timer value (seconds) at UE side</span>
<span class="w">  </span><span class="nt">t3512Value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3600</span><span class="w"> </span><span class="c1"># timer value (seconds) at UE side</span>
<span class="w">  </span><span class="nt">non3gppDeregTimerValue</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3240</span><span class="w"> </span><span class="c1"># timer value (seconds) at UE side</span>
<span class="w">  </span><span class="c1"># retransmission timer for paging message</span>
<span class="w">  </span><span class="nt">t3513</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">     </span><span class="c1"># true or false</span>
<span class="w">    </span><span class="nt">expireTime</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6s</span><span class="w">   </span><span class="c1"># default is 6 seconds</span>
<span class="w">    </span><span class="nt">maxRetryTimes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"> </span><span class="c1"># the max number of retransmission</span>
<span class="w">  </span><span class="c1"># retransmission timer for NAS Deregistration Request message</span>
<span class="w">  </span><span class="nt">t3522</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">     </span><span class="c1"># true or false</span>
<span class="w">    </span><span class="nt">expireTime</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6s</span><span class="w">   </span><span class="c1"># default is 6 seconds</span>
<span class="w">    </span><span class="nt">maxRetryTimes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"> </span><span class="c1"># the max number of retransmission</span>
<span class="w">  </span><span class="c1"># retransmission timer for NAS Registration Accept message</span>
<span class="w">  </span><span class="nt">t3550</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">     </span><span class="c1"># true or false</span>
<span class="w">    </span><span class="nt">expireTime</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6s</span><span class="w">   </span><span class="c1"># default is 6 seconds</span>
<span class="w">    </span><span class="nt">maxRetryTimes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"> </span><span class="c1"># the max number of retransmission</span>
<span class="w">  </span><span class="c1"># retransmission timer for NAS Authentication Request/Security Mode Command message</span>
<span class="w">  </span><span class="nt">t3560</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">     </span><span class="c1"># true or false</span>
<span class="w">    </span><span class="nt">expireTime</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6s</span><span class="w">   </span><span class="c1"># default is 6 seconds</span>
<span class="w">    </span><span class="nt">maxRetryTimes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"> </span><span class="c1"># the max number of retransmission</span>
<span class="w">  </span><span class="c1"># retransmission timer for NAS Notification message</span>
<span class="w">  </span><span class="nt">t3565</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">     </span><span class="c1"># true or false</span>
<span class="w">    </span><span class="nt">expireTime</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6s</span><span class="w">   </span><span class="c1"># default is 6 seconds</span>
<span class="w">    </span><span class="nt">maxRetryTimes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"> </span><span class="c1"># the max number of retransmission</span>
<span class="w">  </span><span class="c1"># retransmission timer for NAS Identity Request message</span>
<span class="w">  </span><span class="nt">t3570</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">     </span><span class="c1"># true or false</span>
<span class="w">    </span><span class="nt">expireTime</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6s</span><span class="w">   </span><span class="c1"># default is 6 seconds</span>
<span class="w">    </span><span class="nt">maxRetryTimes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"> </span><span class="c1"># the max number of retransmission</span>
<span class="w">  </span><span class="nt">locality</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">area1</span><span class="w"> </span><span class="c1"># Name of the location where a set of AMF, SMF, PCF and UPFs are located</span>
<span class="w">  </span><span class="nt">sctp</span><span class="p">:</span><span class="w"> </span><span class="c1"># set the sctp server setting &lt;optinal&gt;, once this field is set, please also add maxInputStream, maxOsStream, maxAttempts, maxInitTimeOut</span>
<span class="w">    </span><span class="nt">numOstreams</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"> </span><span class="c1"># the maximum out streams of each sctp connection</span>
<span class="w">    </span><span class="nt">maxInstreams</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w"> </span><span class="c1"># the maximum in streams of each sctp connection</span>
<span class="w">    </span><span class="nt">maxAttempts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span><span class="c1"># the maximum attempts of each sctp connection</span>
<span class="w">    </span><span class="nt">maxInitTimeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span><span class="c1"># the maximum init timeout of each sctp connection</span>
<span class="w">  </span><span class="nt">defaultUECtxReq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"> </span><span class="c1"># the default value of UE Context Request to decide when triggering Initial Context Setup procedure</span>

<span class="nt">logger</span><span class="p">:</span><span class="w"> </span><span class="c1"># log output setting</span>
<span class="w">  </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># true or false</span>
<span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span><span class="w"> </span><span class="c1"># how detailed to output, value: trace, debug, info, warn, error, fatal, panic</span>
<span class="w">  </span><span class="nt">reportCaller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"> </span><span class="c1"># enable the caller report or not, value: true or false</span>
</code></pre></div><br />
- <strong>free5gc/config/smfcfg.yaml</strong></p>
<p>Replace <strong>userplaneInformation</strong> / <strong>upNodes</strong> / <strong>UPF</strong> / <strong>interfaces</strong> / <strong>endpoints</strong> from <code>127.0.0.8</code> to <code>10.200.200.2</code>:</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">info</span><span class="p">:</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0.7</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SMF initial local configuration</span>

<span class="nt">configuration</span><span class="p">:</span>
<span class="w">  </span><span class="nt">smfName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SMF</span><span class="w"> </span><span class="c1"># the name of this SMF</span>
<span class="w">  </span><span class="nt">sbi</span><span class="p">:</span><span class="w"> </span><span class="c1"># Service-based interface information</span>
<span class="w">    </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"> </span><span class="c1"># the protocol for sbi (http or https)</span>
<span class="w">    </span><span class="nt">registerIPv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.2</span><span class="w"> </span><span class="c1"># IP used to register to NRF</span>
<span class="w">    </span><span class="nt">bindingIPv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.2</span><span class="w"> </span><span class="c1"># IP used to bind the service</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span><span class="w"> </span><span class="c1"># Port used to bind the service</span>
<span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w"> </span><span class="c1"># the local path of TLS key</span>
<span class="w">      </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert/smf.key</span><span class="w"> </span><span class="c1"># SMF TLS Certificate</span>
<span class="w">      </span><span class="nt">pem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert/smf.pem</span><span class="w"> </span><span class="c1"># SMF TLS Private key</span>
<span class="w">  </span><span class="nt">serviceNameList</span><span class="p">:</span><span class="w"> </span><span class="c1"># the SBI services provided by this SMF, refer to TS 29.502</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nsmf-pdusession</span><span class="w"> </span><span class="c1"># Nsmf_PDUSession service</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nsmf-event-exposure</span><span class="w"> </span><span class="c1"># Nsmf_EventExposure service</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nsmf-oam</span><span class="w"> </span><span class="c1"># OAM service</span>
<span class="w">  </span><span class="nt">snssaiInfos</span><span class="p">:</span><span class="w"> </span><span class="c1"># the S-NSSAI (Single Network Slice Selection Assistance Information) list supported by this AMF</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sNssai</span><span class="p">:</span><span class="w"> </span><span class="c1"># S-NSSAI (Single Network Slice Selection Assistance Information)</span>
<span class="w">        </span><span class="nt">sst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># Slice/Service Type (uinteger, range: 0~255)</span>
<span class="w">        </span><span class="nt">sd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">010203</span><span class="w"> </span><span class="c1"># Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)</span>
<span class="w">      </span><span class="nt">dnnInfos</span><span class="p">:</span><span class="w"> </span><span class="c1"># DNN information list</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dnn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">internet</span><span class="w"> </span><span class="c1"># Data Network Name</span>
<span class="w">          </span><span class="nt">dns</span><span class="p">:</span><span class="w"> </span><span class="c1"># the IP address of DNS</span>
<span class="w">            </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8.8.8.8</span>
<span class="w">            </span><span class="nt">ipv6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2001:4860:4860::8888</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sNssai</span><span class="p">:</span><span class="w"> </span><span class="c1"># S-NSSAI (Single Network Slice Selection Assistance Information)</span>
<span class="w">        </span><span class="nt">sst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># Slice/Service Type (uinteger, range: 0~255)</span>
<span class="w">        </span><span class="nt">sd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">112233</span><span class="w"> </span><span class="c1"># Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)</span>
<span class="w">      </span><span class="nt">dnnInfos</span><span class="p">:</span><span class="w"> </span><span class="c1"># DNN information list</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dnn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">internet</span><span class="w"> </span><span class="c1"># Data Network Name</span>
<span class="w">          </span><span class="nt">dns</span><span class="p">:</span><span class="w"> </span><span class="c1"># the IP address of DNS</span>
<span class="w">            </span><span class="nt">ipv4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8.8.8.8</span>
<span class="w">            </span><span class="nt">ipv6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2001:4860:4860::8888</span>
<span class="w">  </span><span class="nt">plmnList</span><span class="p">:</span><span class="w"> </span><span class="c1"># the list of PLMN IDs that this SMF belongs to (optional, remove this key when unnecessary)</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mcc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">208</span><span class="w"> </span><span class="c1"># Mobile Country Code (3 digits string, digit: 0~9)</span>
<span class="w">      </span><span class="nt">mnc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">93</span><span class="w"> </span><span class="c1"># Mobile Network Code (2 or 3 digits string, digit: 0~9)</span>
<span class="w">  </span><span class="nt">locality</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">area1</span><span class="w"> </span><span class="c1"># Name of the location where a set of AMF, SMF, PCF and UPFs are located</span>
<span class="w">  </span><span class="nt">pfcp</span><span class="p">:</span><span class="w"> </span><span class="c1"># the IP address of N4 interface on this SMF (PFCP)</span>
<span class="w">    </span><span class="c1"># addr config is deprecated in smf config v1.0.3, please use the following config</span>
<span class="w">    </span><span class="nt">nodeID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span><span class="w"> </span><span class="c1"># the Node ID of this SMF</span>
<span class="w">    </span><span class="nt">listenAddr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span><span class="w"> </span><span class="c1"># the IP/FQDN of N4 interface on this SMF (PFCP)</span>
<span class="w">    </span><span class="nt">externalAddr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span><span class="w"> </span><span class="c1"># the IP/FQDN of N4 interface on this SMF (PFCP)</span>
<span class="w">  </span><span class="nt">userplaneInformation</span><span class="p">:</span><span class="w"> </span><span class="c1"># list of userplane information</span>
<span class="w">    </span><span class="nt">upNodes</span><span class="p">:</span><span class="w"> </span><span class="c1"># information of userplane node (AN or UPF)</span>
<span class="w">      </span><span class="nt">gNB1</span><span class="p">:</span><span class="w"> </span><span class="c1"># the name of the node</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AN</span><span class="w"> </span><span class="c1"># the type of the node (AN or UPF)</span>
<span class="w">      </span><span class="nt">UPF</span><span class="p">:</span><span class="w"> </span><span class="c1"># the name of the node</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UPF</span><span class="w"> </span><span class="c1"># the type of the node (AN or UPF)</span>
<span class="w">        </span><span class="nt">nodeID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.8</span><span class="w"> </span><span class="c1"># the Node ID of this UPF</span>
<span class="w">        </span><span class="nt">addr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.8</span><span class="w"> </span><span class="c1"># the IP/FQDN of N4 interface on this UPF (PFCP)</span>
<span class="w">        </span><span class="nt">sNssaiUpfInfos</span><span class="p">:</span><span class="w"> </span><span class="c1"># S-NSSAI information list for this UPF</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sNssai</span><span class="p">:</span><span class="w"> </span><span class="c1"># S-NSSAI (Single Network Slice Selection Assistance Information)</span>
<span class="w">              </span><span class="nt">sst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># Slice/Service Type (uinteger, range: 0~255)</span>
<span class="w">              </span><span class="nt">sd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">010203</span><span class="w"> </span><span class="c1"># Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)</span>
<span class="w">            </span><span class="nt">dnnUpfInfoList</span><span class="p">:</span><span class="w"> </span><span class="c1"># DNN information list for this S-NSSAI</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dnn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">internet</span>
<span class="w">                </span><span class="nt">pools</span><span class="p">:</span>
<span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.60.0.0/16</span>
<span class="w">                </span><span class="nt">staticPools</span><span class="p">:</span>
<span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.60.100.0/24</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sNssai</span><span class="p">:</span><span class="w"> </span><span class="c1"># S-NSSAI (Single Network Slice Selection Assistance Information)</span>
<span class="w">              </span><span class="nt">sst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># Slice/Service Type (uinteger, range: 0~255)</span>
<span class="w">              </span><span class="nt">sd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">112233</span><span class="w"> </span><span class="c1"># Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)</span>
<span class="w">            </span><span class="nt">dnnUpfInfoList</span><span class="p">:</span><span class="w"> </span><span class="c1"># DNN information list for this S-NSSAI</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dnn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">internet</span>
<span class="w">                </span><span class="nt">pools</span><span class="p">:</span>
<span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.61.0.0/16</span>
<span class="w">                </span><span class="nt">staticPools</span><span class="p">:</span>
<span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.61.100.0/24</span>
<span class="w">        </span><span class="nt">interfaces</span><span class="p">:</span><span class="w"> </span><span class="c1"># Interface list for this UPF</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">interfaceType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">N3</span><span class="w"> </span><span class="c1"># the type of the interface (N3 or N9)</span>
<span class="w">            </span><span class="nt">endpoints</span><span class="p">:</span><span class="w"> </span><span class="c1"># the IP address of this N3/N9 interface on this UPF</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.200.200.2</span><span class="w"> </span><span class="c1"># 127.0.0.8</span>
<span class="w">            </span><span class="nt">networkInstances</span><span class="p">:</span><span class="w">  </span><span class="c1"># Data Network Name (DNN)</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">internet</span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span><span class="w"> </span><span class="c1"># the topology graph of userplane, A and B represent the two nodes of each link</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">A</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gNB1</span>
<span class="w">        </span><span class="nt">B</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UPF</span>
<span class="w">  </span><span class="c1"># retransmission timer for pdu session modification command</span>
<span class="w">  </span><span class="nt">t3591</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">     </span><span class="c1"># true or false</span>
<span class="w">    </span><span class="nt">expireTime</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16s</span><span class="w">   </span><span class="c1"># default is 6 seconds</span>
<span class="w">    </span><span class="nt">maxRetryTimes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"> </span><span class="c1"># the max number of retransmission</span>
<span class="w">  </span><span class="c1"># retransmission timer for pdu session release command</span>
<span class="w">  </span><span class="nt">t3592</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">     </span><span class="c1"># true or false</span>
<span class="w">    </span><span class="nt">expireTime</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16s</span><span class="w">   </span><span class="c1"># default is 6 seconds</span>
<span class="w">    </span><span class="nt">maxRetryTimes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"> </span><span class="c1"># the max number of retransmission</span>
<span class="w">  </span><span class="nt">nrfUri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://127.0.0.10:8000</span><span class="w"> </span><span class="c1"># a valid URI of NRF</span>
<span class="w">  </span><span class="c1">#urrPeriod: 10 # default usage report period in seconds</span>
<span class="w">  </span><span class="c1">#urrThreshold: 1000 # default usage report threshold in bytes</span>

<span class="nt">logger</span><span class="p">:</span><span class="w"> </span><span class="c1"># log output setting</span>
<span class="w">  </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># true or false</span>
<span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span><span class="w"> </span><span class="c1"># how detailed to output, value: trace, debug, info, warn, error, fatal, panic</span>
<span class="w">  </span><span class="nt">reportCaller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"> </span><span class="c1"># enable the caller report or not, value: true or false</span>
</code></pre></div><br />
- <strong>free5gc/config/upfcfg.yaml</strong></p>
<p>Replace <strong>gtpu</strong> from <code>127.0.0.8</code>to <code>10.200.200.2</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0.3</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UPF initial local configuration</span>

<span class="c1"># The listen IP and nodeID of the N4 interface on this UPF (Can&#39;t set to 0.0.0.0)</span>
<span class="nt">pfcp</span><span class="p">:</span>
<span class="w">  </span><span class="nt">addr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.8</span><span class="w">   </span><span class="c1"># IP addr for listening</span>
<span class="w">  </span><span class="nt">nodeID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.8</span><span class="w"> </span><span class="c1"># External IP or FQDN can be reached</span>
<span class="w">  </span><span class="nt">retransTimeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1s</span><span class="w"> </span><span class="c1"># retransmission timeout</span>
<span class="w">  </span><span class="nt">maxRetrans</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"> </span><span class="c1"># the max number of retransmission</span>

<span class="nt">gtpu</span><span class="p">:</span>
<span class="w">  </span><span class="nt">forwarder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gtp5g</span>
<span class="w">  </span><span class="c1"># The IP list of the N3/N9 interfaces on this UPF</span>
<span class="w">  </span><span class="c1"># If there are multiple connection, set addr to 0.0.0.0 or list all the addresses</span>
<span class="w">  </span><span class="nt">ifList</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">addr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.200.200.2</span><span class="w"> </span><span class="c1"># 127.0.0.8</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">N3</span>
<span class="w">      </span><span class="c1"># name: upf.5gc.nctu.me</span>
<span class="w">      </span><span class="c1"># ifname: gtpif</span>
<span class="w">      </span><span class="c1"># mtu: 1400</span>

<span class="c1"># The DNN list supported by UPF</span>
<span class="nt">dnnList</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dnn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">internet</span><span class="w"> </span><span class="c1"># Data Network Name</span>
<span class="w">    </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.60.0.0/24</span><span class="w"> </span><span class="c1"># Classless Inter-Domain Routing for assigned IPv4 pool of UE</span>
<span class="w">    </span><span class="c1"># natifname: eth0</span>

<span class="nt">logger</span><span class="p">:</span><span class="w"> </span><span class="c1"># log output setting</span>
<span class="w">  </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># true or false</span>
<span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span><span class="w"> </span><span class="c1"># how detailed to output, value: trace, debug, info, warn, error, fatal, panic</span>
<span class="w">  </span><span class="nt">reportCaller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"> </span><span class="c1"># enable the caller report or not, value: true or false</span>
</code></pre></div>
<h3 id="ueransim">UERANSIM</h3>
<ul>
<li>
<p><strong>UERANSIM/config/free5gc-gnb.yaml</strong></p>
</li>
<li>
<p>Replace ngapIp from <code>127.0.0.1</code>to <code>10.200.200.1</code></p>
</li>
<li>
<p>Replace gtpIp from <code>127.0.0.1</code>to <code>10.200.200.1</code></p>
</li>
<li>
<p>Replace <strong>amfConfigs</strong> / <strong>address</strong> from <code>127.0.0.1</code>to <code>10.200.200.2</code></p>
</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="nt">mcc</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;208&#39;</span><span class="w">          </span><span class="c1"># Mobile Country Code value</span>
<span class="nt">mnc</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;93&#39;</span><span class="w">           </span><span class="c1"># Mobile Network Code value (2 or 3 digits)</span>

<span class="nt">nci</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0x000000010&#39;</span><span class="w">  </span><span class="c1"># NR Cell Identity (36-bit)</span>
<span class="nt">idLength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span><span class="w">        </span><span class="c1"># NR gNB ID length in bits [22...32]</span>
<span class="nt">tac</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">              </span><span class="c1"># Tracking Area Code</span>

<span class="nt">linkIp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span><span class="w">   </span><span class="c1"># gNB&#39;s local IP address for Radio Link Simulation (Usually same with local IP)</span>
<span class="nt">ngapIp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.200.200.1</span><span class="w"> </span><span class="c1"># 127.0.0.1   # gNB&#39;s local IP address for N2 Interface (Usually same with local IP)</span>
<span class="nt">gtpIp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.200.200.1</span><span class="w"> </span><span class="c1"># 127.0.0.1    # gNB&#39;s local IP address for N3 Interface (Usually same with local IP)</span>

<span class="c1"># List of AMF address information</span>
<span class="nt">amfConfigs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.200.200.2</span><span class="w"> </span><span class="c1"># 127.0.0.1</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">38412</span>

<span class="c1"># List of supported S-NSSAIs by this gNB</span>
<span class="nt">slices</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x1</span>
<span class="w">    </span><span class="nt">sd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x010203</span>

<span class="c1"># Indicates whether or not SCTP stream number errors should be ignored.</span>
<span class="nt">ignoreStreamIds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div><br />
- <strong>UERANSIM/config/free5gc-ue.yaml</strong><br />
<div class="highlight"><pre><span></span><code><span class="c1"># IMSI number of the UE. IMSI = [MCC|MNC|MSISDN] (In total 15 or 16 digits)</span>
<span class="nt">supi</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;imsi-208930000000003&#39;</span>
<span class="c1"># Mobile Country Code value</span>
<span class="nt">mcc</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;208&#39;</span>
<span class="c1"># Mobile Network Code value (2 or 3 digits)</span>
<span class="nt">mnc</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;93&#39;</span>

<span class="c1"># Permanent subscription key</span>
<span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;8baf473f2f8fd09487cccbd7097c6862&#39;</span>
<span class="c1"># Operator code (OP or OPC) of the UE</span>
<span class="nt">op</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;8e27b6af0e692e750f32667a3b14605d&#39;</span>
<span class="c1"># This value specifies the OP type and it can be either &#39;OP&#39; or &#39;OPC&#39;</span>
<span class="nt">opType</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;OP&#39;</span>
<span class="c1"># Authentication Management Field (AMF) value</span>
<span class="nt">amf</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;8000&#39;</span>
<span class="c1"># IMEI number of the device. It is used if no SUPI is provided</span>
<span class="nt">imei</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;356938035643803&#39;</span>
<span class="c1"># IMEISV number of the device. It is used if no SUPI and IMEI is provided</span>
<span class="nt">imeiSv</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;4370816125816151&#39;</span>

<span class="c1"># List of gNB IP addresses for Radio Link Simulation</span>
<span class="nt">gnbSearchList</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span>

<span class="c1"># Initial PDU sessions to be established</span>
<span class="nt">sessions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;IPv4&#39;</span>
<span class="w">    </span><span class="nt">apn</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;internet&#39;</span>
<span class="w">    </span><span class="nt">slice</span><span class="p">:</span>
<span class="w">      </span><span class="nt">sst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x01</span>
<span class="w">      </span><span class="nt">sd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x010203</span>

<span class="c1"># List of requested S-NSSAIs by this UE</span>
<span class="nt">slices</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x01</span>
<span class="w">    </span><span class="nt">sd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x010203</span>

<span class="c1"># Supported encryption and integrity algorithms by this UE</span>
<span class="nt">integrity</span><span class="p">:</span>
<span class="w">  </span><span class="nt">IA1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">IA2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">IA3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">ciphering</span><span class="p">:</span>
<span class="w">  </span><span class="nt">EA1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">EA2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">EA3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div></p>
<h2 id="environment-set-up-of-free5gc-and-ueransim">Environment set up of free5GC and UERANSIM</h2>
<p>First, create a namespace:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Assume that you are either running as root, or it behoves you to prepend <code>sudo</code> to commands as necessary.</p>
</div>
<p><div class="highlight"><pre><span></span><code>ip netns add ueransim
</code></pre></div><br />
Next, add the bridge:<br />
<div class="highlight"><pre><span></span><code>ip link add free5gc-br type bridge
</code></pre></div><br />
Add two pairs of veth:<br />
<div class="highlight"><pre><span></span><code>ip link add veth0 type veth peer name br-veth0
ip link add veth1 type veth peer name br-veth1
</code></pre></div><br />
Now, it could be like:<br />
<div class="highlight"><pre><span></span><code>root@free5gc:~# ip a
1<span class="p">:</span> <span class="nl">lo</span><span class="c1">: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2<span class="p">:</span> <span class="nl">enp0s5</span><span class="c1">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span>
    link/ether 00:1c:42:b1:ba:f4 brd ff:ff:ff:ff:ff:ff
    inet 10.211.55.23/24 brd 10.211.55.255 scope global dynamic enp0s5
       valid_lft 1714sec preferred_lft 1714sec
    inet6 fdb2:2c26:f4e4:0:21c:42ff:feb1:baf4/64 scope global dynamic mngtmpaddr noprefixroute
       valid_lft 2591750sec preferred_lft 604550sec
    inet6 fe80::21c:42ff:feb1:baf4/64 scope link
       valid_lft forever preferred_lft forever
3<span class="p">:</span> <span class="nl">enp0s6</span><span class="c1">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span>
    link/ether 00:1c:42:f1:11:c6 brd ff:ff:ff:ff:ff:ff
    inet 10.37.129.20/24 brd 10.37.129.255 scope global enp0s6
       valid_lft forever preferred_lft forever
    inet6 fdb2:2c26:f4e4:1:21c:42ff:fef1:11c6/64 scope global dynamic mngtmpaddr noprefixroute
       valid_lft 2591750sec preferred_lft 604550sec
    inet6 fe80::21c:42ff:fef1:11c6/64 scope link
       valid_lft forever preferred_lft forever
4<span class="p">:</span> <span class="nl">free5gc-br</span><span class="c1">: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span>
    link/ether 4e:f6:d7:9c:50:de brd ff:ff:ff:ff:ff:ff
5<span class="p">:</span> <span class="nl">br-veth0@veth0</span><span class="c1">: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span>
    link/ether c2:31:0c:5f:45:81 brd ff:ff:ff:ff:ff:ff
6<span class="p">:</span> <span class="nl">veth0@br-veth0</span><span class="c1">: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span>
    link/ether 4a:0f:1e:80:9b:be brd ff:ff:ff:ff:ff:ff
7<span class="p">:</span> <span class="nl">br-veth1@veth1</span><span class="c1">: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span>
    link/ether 56:99:b0:82:78:0d brd ff:ff:ff:ff:ff:ff
8<span class="p">:</span> <span class="nl">veth1@br-veth1</span><span class="c1">: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span>
    link/ether 12:5a:56:00:5b:be brd ff:ff:ff:ff:ff:ff
</code></pre></div></p>
<p><strong>Next</strong>, assign interface to namespace:<br />
<div class="highlight"><pre><span></span><code>ip link set dev veth0 netns ueransim
</code></pre></div><br />
Set ip address:<br />
<div class="highlight"><pre><span></span><code>ip netns exec ueransim ip a add 10.200.200.1/24 dev veth0
</code></pre></div><br />
Enable both interface. Don't forget <strong>lo</strong>:<br />
<div class="highlight"><pre><span></span><code>ip netns exec ueransim ip link set lo up
ip netns exec ueransim ip link set veth0 up
</code></pre></div><br />
Check with <strong><code>ip a</code></strong>:<br />
<div class="highlight"><pre><span></span><code>root@free5gc:~# ip netns exec ueransim ip a
1<span class="p">:</span> <span class="nl">lo</span><span class="c1">: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
6<span class="p">:</span> <span class="nl">veth0@if5</span><span class="c1">: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state LOWERLAYERDOWN group default qlen 1000</span>
    link/ether 4a:0f:1e:80:9b:be brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.200.200.1/24 scope global veth0
       valid_lft forever preferred_lft forever
</code></pre></div><br />
Set for veth1 as well:<br />
<div class="highlight"><pre><span></span><code>ip a add 10.200.200.2/24 dev veth1
ip link set veth1 up
</code></pre></div><br />
Let two interfaces attatch to bridge:<br />
<div class="highlight"><pre><span></span><code>ip link set dev br-veth0 master free5gc-br
ip link set dev br-veth1 master free5gc-br
ip link set br-veth0 up
ip link set br-veth1 up
ip link set free5gc-br up
</code></pre></div><br />
Using <code>bridge link</code> to check:<br />
<div class="highlight"><pre><span></span><code>root@free5gc:~# bridge link
5<span class="p">:</span> <span class="nl">br-veth0@if6</span><span class="c1">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 master free5gc-br state forwarding priority 32 cost 2</span>
7<span class="p">:</span> <span class="nl">br-veth1@veth1</span><span class="c1">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 master free5gc-br state forwarding priority 32 cost 2</span>
</code></pre></div><br />
Now it looks like:<br />
<div class="highlight"><pre><span></span><code>1<span class="p">:</span> <span class="nl">lo</span><span class="c1">: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2<span class="p">:</span> <span class="nl">enp0s5</span><span class="c1">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span>
    link/ether 00:1c:42:b1:ba:f4 brd ff:ff:ff:ff:ff:ff
    inet 10.211.55.23/24 brd 10.211.55.255 scope global dynamic enp0s5
       valid_lft 1000sec preferred_lft 1000sec
    inet6 fdb2:2c26:f4e4:0:21c:42ff:feb1:baf4/64 scope global dynamic mngtmpaddr noprefixroute
       valid_lft 2591870sec preferred_lft 604670sec
    inet6 fe80::21c:42ff:feb1:baf4/64 scope link
       valid_lft forever preferred_lft forever
3<span class="p">:</span> <span class="nl">enp0s6</span><span class="c1">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span>
    link/ether 00:1c:42:f1:11:c6 brd ff:ff:ff:ff:ff:ff
    inet 10.37.129.20/24 brd 10.37.129.255 scope global enp0s6
       valid_lft forever preferred_lft forever
    inet6 fdb2:2c26:f4e4:1:21c:42ff:fef1:11c6/64 scope global dynamic mngtmpaddr noprefixroute
       valid_lft 2591870sec preferred_lft 604670sec
    inet6 fe80::21c:42ff:fef1:11c6/64 scope link
       valid_lft forever preferred_lft forever
4<span class="p">:</span> <span class="nl">free5gc-br</span><span class="c1">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span>
    link/ether 56:99:b0:82:78:0d brd ff:ff:ff:ff:ff:ff
    inet6 fe80::5499:b0ff:fe82:780d/64 scope link
       valid_lft forever preferred_lft forever
5<span class="p">:</span> <span class="nl">br-veth0@if6</span><span class="c1">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master free5gc-br state UP group default qlen 1000</span>
    link/ether c2:31:0c:5f:45:81 brd ff:ff:ff:ff:ff:ff link-netns ueransim
    inet6 fe80::c031:cff:fe5f:4581/64 scope link
       valid_lft forever preferred_lft forever
7<span class="p">:</span> <span class="nl">br-veth1@veth1</span><span class="c1">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master free5gc-br state UP group default qlen 1000</span>
    link/ether 56:99:b0:82:78:0d brd ff:ff:ff:ff:ff:ff
    inet6 fe80::5499:b0ff:fe82:780d/64 scope link
       valid_lft forever preferred_lft forever
8<span class="p">:</span> <span class="nl">veth1@br-veth1</span><span class="c1">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span>
    link/ether 12:5a:56:00:5b:be brd ff:ff:ff:ff:ff:ff
    inet 10.200.200.2/24 scope global veth1
       valid_lft forever preferred_lft forever
    inet6 fe80::105a:56ff:fe00:5bbe/64 scope link
       valid_lft forever preferred_lft forever
</code></pre></div><br />
<strong>Let's test it</strong>:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can perform <code>ip netns exec ueransim /bin/bash --rcfile &lt;(echo "PS1=\"ueransim&gt; \"")</code> to enter namespace and modify shell prefix.</p>
</div>
<p><div class="highlight"><pre><span></span><code>root@free5gc:~# ip netns exec ueransim /bin/bash --rcfile <span class="p">&lt;</span>(echo <span class="s2">&quot;PS1=\&quot;</span>ueransim<span class="p">&gt;</span> \<span class="s2">&quot;&quot;</span>)
ueransim<span class="p">&gt;</span> ping -c2 10.200.200.2
PING 10.200.200.2 (10.200.200.2) 56(84) bytes of data.
64 bytes from 10.200.200.2: icmp_seq=1 ttl=64 time=0.089 ms
64 bytes from 10.200.200.2: icmp_seq=2 ttl=64 time=0.226 ms

--- 10.200.200.2 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1020ms
rtt min/avg/max/mdev = 0.089/0.157/0.226/0.068 ms
</code></pre></div><br />
Insert default routing rule:<br />
<div class="highlight"><pre><span></span><code>ueransim<span class="p">&gt;</span> ip route add default via 10.200.200.2
ueransim<span class="p">&gt;</span> netstat -rn
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
0.0.0.0         10.200.200.2    0.0.0.0         UG        0 0          0 veth0
10.200.200.0    0.0.0.0         255.255.255.0   U         0 0          0 veth0
</code></pre></div><br />
Try to ping 8.8.8.8:<br />
<div class="highlight"><pre><span></span><code>ueransim<span class="p">&gt;</span> ping -c2 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 0 received, 100% packet loss, time 1028ms
</code></pre></div><br />
It is because the main host must translate the source addresses. Besides, the main host need to forward packet:<br />
<div class="highlight"><pre><span></span><code>root@free5gc:~# iptables -t nat -A POSTROUTING -o enp0s5 -j MASQUERADE
root@free5gc:~# sysctl -w net.ipv4.ip_forward=1
root@free5gc:~# sudo iptables -I FORWARD 1 -j ACCEPT
</code></pre></div><br />
And then:<br />
<div class="highlight"><pre><span></span><code>ueransim<span class="p">&gt;</span> ping -c2 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=127 time=13.9 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=127 time=28.0 ms

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 13.866/20.939/28.012/7.073 ms
</code></pre></div></p>
<p>After free5GC execute <code>run.sh</code>, it's time for UERANSIM:</p>
<p><strong>In terminal 1</strong>:<br />
<div class="highlight"><pre><span></span><code>ueransim<span class="p">&gt;</span> build/nr-gnb -c config/free5gc-gnb.yaml
UERANSIM v3.1.0
[2023-07-05 19:58:26.368] [sctp] [info] Trying to establish SCTP connection... (10.200.200.2:38412)
[2023-07-05 19:58:26.373] [sctp] [info] SCTP connection established (10.200.200.2:38412)
[2023-07-05 19:58:26.374] [sctp] [debug] SCTP association setup ascId[3]
[2023-07-05 19:58:26.375] [ngap] [debug] Sending NG Setup Request
[2023-07-05 19:58:26.380] [ngap] [debug] NG Setup Response received
[2023-07-05 19:58:26.380] [ngap] [info] NG Setup procedure is successful
[2023-07-05 19:58:35.804] [mr] [info] New UE connected to gNB. Total number of UEs is now: 1
[2023-07-05 19:58:35.806] [rrc] [debug] Sending RRC Setup for UE[3]
[2023-07-05 19:58:35.807] [ngap] [debug] Initial NAS message received from UE 3
[2023-07-05 19:58:35.869] [ngap] [debug] Initial Context Setup Request received
[2023-07-05 19:58:36.108] [ngap] [info] PDU session resource is established for UE[3] count[1]
</code></pre></div><br />
<strong>In terminal 2</strong>:<br />
<div class="highlight"><pre><span></span><code>ueransim<span class="p">&gt;</span> sudo build/nr-ue -c config/free5gc-ue.yaml
UERANSIM v3.1.0
[2023-07-05 19:58:35.803] [nas] [debug] NAS layer started
[2023-07-05 19:58:35.803] [rrc] [debug] RRC layer started
[2023-07-05 19:58:35.804] [nas] [info] UE switches to state: MM-DEREGISTERED/PLMN-SEARCH
[2023-07-05 19:58:35.804] [nas] [info] UE connected to gNB
[2023-07-05 19:58:35.804] [nas] [info] UE switches to state: MM-DEREGISTERED/NORMAL-SERVICE
[2023-07-05 19:58:35.804] [nas] [info] UE switches to state: MM-REGISTERED-INITIATED/NA
[2023-07-05 19:58:35.805] [rrc] [debug] Sending RRC Setup Request
[2023-07-05 19:58:35.806] [rrc] [info] RRC connection established
[2023-07-05 19:58:35.806] [nas] [info] UE switches to state: CM-CONNECTED
[2023-07-05 19:58:35.838] [nas] [debug] Received rand[61262F32A617D0BAD716603B1CBDA477] autn[44778026F4238000FC14B59D68855328]
[2023-07-05 19:58:35.838] [nas] [debug] Calculated res[47759045F5ACEA59] ck[1C559301F29EF49572F5D150B3B99288] ik[D223317F752F233CE4C7AA253644D882] ak[528433D1FBE6] mac_a[FC14B59D68855328]
[2023-07-05 19:58:35.838] [nas] [debug] Used snn[5G:mnc093.mcc208.3gppnetwork.org] sqn[16F3B3F70FC5]
[2023-07-05 19:58:35.838] [nas] [debug] Derived kSeaf[7FC8B7FB1B141B6579B9C0FAEB9CCF1312FE9F9634868E234756DE49FD67C5F1] kAusf[FA0402A892E6046D52F4DECACA40B2A75B698FCEAD5EB320139FC69B77BD4C46] kAmf[3D4AD68E153B9642ACBECC67AD399015F7CB578F9DF4C88A35EED99C72C9B95B]
[2023-07-05 19:58:35.843] [nas] [debug] Derived kNasEnc[1F829EB2BA238DD0226C3484E6A79D1F] kNasInt[251C0412B1BAD88A9DD0008F32D6F216]
[2023-07-05 19:58:35.843] [nas] [debug] Selected integrity[2] ciphering[0]
[2023-07-05 19:58:35.869] [nas] [debug] T3512 started with int[3600]
[2023-07-05 19:58:35.869] [nas] [info] UE switches to state: MM-REGISTERED/NORMAL-SERVICE
[2023-07-05 19:58:35.869] [nas] [info] Initial Registration is successful
[2023-07-05 19:58:35.869] [nas] [info] Initial PDU sessions are establishing [1#]
[2023-07-05 19:58:35.869] [nas] [debug] Sending PDU session establishment request
[2023-07-05 19:58:36.108] [nas] [info] PDU Session establishment is successful PSI[1]
[2023-07-05 19:58:36.113] [app] [info] Connection setup for PDU session[1] is successful, TUN interface[uesimtun0, 10.60.0.1] is up.
</code></pre></div><br />
<strong>In terminal 3</strong>:<br />
<div class="highlight"><pre><span></span><code>ueransim<span class="p">&gt;</span> ip a
1<span class="p">:</span> <span class="nl">lo</span><span class="c1">: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2<span class="p">:</span> <span class="nl">uesimtun0</span><span class="c1">: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500</span>
    link/none
    inet 10.60.0.1/32 scope global uesimtun0
       valid_lft forever preferred_lft forever
    inet6 fe80::b5ef:5b4:e3f6:af64/64 scope link stable-privacy
       valid_lft forever preferred_lft forever
6<span class="p">:</span> <span class="nl">veth0@if5</span><span class="c1">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span>
    link/ether 4a:0f:1e:80:9b:be brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.200.200.1/24 scope global veth0
       valid_lft forever preferred_lft forever
    inet6 fe80::480f:1eff:fe80:9bbe/64 scope link
       valid_lft forever preferred_lft forever
ueransim<span class="p">&gt;</span> ping -c2 -I uesimtun0 8.8.8.8
PING 8.8.8.8 (8.8.8.8) from 10.60.0.1 uesimtun0: 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=127 time=19.5 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=127 time=33.2 ms

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1006ms
rtt min/avg/max/mdev = 19.478/26.348/33.219/6.870 ms
</code></pre></div><br />
Also ping to google.com:<br />
<div class="highlight"><pre><span></span><code>ueransim<span class="p">&gt;</span> ping -c2 -I uesimtun0 google.com
PING google.com (172.217.160.110) from 10.60.0.1 uesimtun0: 56(84) bytes of data.
64 bytes from tsa03s06-in-f14.1e100.net (172.217.160.110): icmp_seq=1 ttl=127 time=17.3 ms
64 bytes from tsa03s06-in-f14.1e100.net (172.217.160.110): icmp_seq=2 ttl=127 time=29.5 ms

--- google.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1005ms
rtt min/avg/max/mdev = 17.295/23.385/29.476/6.090 ms
</code></pre></div></p>
<h2 id="what-if-two-ueransims-with-two-namespaces">What if two UERANSIMs with two namespaces?</h2>
<p><img alt="" src="../1-2.png" /></p>
<p>Same as before, you should create another namespace for UERANSIM, called it ueransim2:<br />
<div class="highlight"><pre><span></span><code>root@free5gc:~# ip netns ls
ueransim2 (id: 1)
ueransim (id: 0)
</code></pre></div><br />
And then:<br />
<div class="highlight"><pre><span></span><code>ip link add veth2 type veth peer name br-veth2
ip link set dev veth2 netns ueransim2
ip link set br-veth2 master free5gc-br
ip link set br-veth2 up
ip netns exec ueransim2 ip a add 10.200.200.3/24 dev veth2
ip netns exec ueransim2 ip link set lo up
ip netns exec ueransim2 ip link set veth2 up
ip netns exec ueransim2 ip route add default via 10.200.200.2
</code></pre></div></p>
<p>Copy <strong>UERANSIM/config/free5gc-gnb.yaml</strong> and <strong>UERANSIM/config/free5gc-ue.yaml</strong> to <strong>free5gc-gnb2.yaml</strong> and <strong>free5gc-ue2.yaml</strong>, modify:</p>
<p><strong>free5gc-gnb2.yaml</strong></p>
<ul>
<li>Replace ngapIp from <code>127.0.0.1</code> to <code>10.200.200.3</code></li>
<li>Replace gtpIp from <code>127.0.0.1</code> to <code>10.200.200.3</code></li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">ngapIp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.200.200.3</span><span class="w"> </span><span class="c1"># 127.0.0.1   # gNB&#39;s local IP address for N2 Interface (Usually same with local IP)</span>
<span class="nt">gtpIp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.200.200.3</span><span class="w"> </span><span class="c1"># 127.0.0.1    # gNB&#39;s local IP address for N3 Interface (Usually same with local IP)</span>

<span class="c1"># List of AMF address information</span>
<span class="nt">amfConfigs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.200.200.2</span><span class="w"> </span><span class="c1"># 127.0.0.1</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">38412</span>
<span class="nn">...</span>
</code></pre></div><br />
<strong>free5gc-ue2.yaml</strong></p>
<p><code>supi</code> change to <code>imsi-208930000000004</code></p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="c1"># IMSI number of the UE. IMSI = [MCC|MNC|MSISDN] (In total 15 or 16 digits)</span>
<span class="nt">supi</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;imsi-208930000000004&#39;</span>
<span class="nn">...</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Should register ue to webconsole first.</p>
</div>
<p>The result:<br />
<div class="highlight"><pre><span></span><code>ueransim<span class="p">&gt;</span> ip a
1<span class="p">:</span> <span class="nl">lo</span><span class="c1">: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
6<span class="p">:</span> <span class="nl">veth0@if5</span><span class="c1">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span>
    link/ether 4a:0f:1e:80:9b:be brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.200.200.1/24 scope global veth0
       valid_lft forever preferred_lft forever
    inet6 fe80::480f:1eff:fe80:9bbe/64 scope link
       valid_lft forever preferred_lft forever
7<span class="p">:</span> <span class="nl">uesimtun0</span><span class="c1">: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500</span>
    link/none
    inet 10.60.0.1/32 scope global uesimtun0
       valid_lft forever preferred_lft forever
    inet6 fe80::f6d7:dd81:fe7f:496a/64 scope link stable-privacy
       valid_lft forever preferred_lft forever
ueransim<span class="p">&gt;</span> ping -c2 -I uesimtun0 google.com
PING google.com (172.217.160.110) from 10.60.0.1 uesimtun0: 56(84) bytes of data.
64 bytes from tsa03s06-in-f14.1e100.net (172.217.160.110): icmp_seq=1 ttl=127 time=17.2 ms
64 bytes from tsa03s06-in-f14.1e100.net (172.217.160.110): icmp_seq=2 ttl=127 time=28.5 ms

--- google.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1003ms
rtt min/avg/max/mdev = 17.200/22.863/28.527/5.663 ms
</code></pre></div></p>
<div class="highlight"><pre><span></span><code>ueransim2<span class="p">&gt;</span> ip a
1<span class="p">:</span> <span class="nl">lo</span><span class="c1">: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
5<span class="p">:</span> <span class="nl">uesimtun0</span><span class="c1">: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500</span>
    link/none
    inet 10.60.0.2/32 scope global uesimtun0
       valid_lft forever preferred_lft forever
    inet6 fe80::16a4:523a:a86:bf83/64 scope link stable-privacy
       valid_lft forever preferred_lft forever
12: veth2@if11: <span class="p">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="p">&gt;</span> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether fa:12:bb:9c:fa:40 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.200.200.3/24 scope global veth2
       valid_lft forever preferred_lft forever
    inet6 fe80::f812:bbff:fe9c:fa40/64 scope link
       valid_lft forever preferred_lft forever
ueransim2<span class="p">&gt;</span> ping -c2 -I uesimtun0 google.com
PING google.com (172.217.160.110) from 10.60.0.2 uesimtun0: 56(84) bytes of data.
64 bytes from tsa03s06-in-f14.1e100.net (172.217.160.110): icmp_seq=1 ttl=127 time=18.9 ms
64 bytes from tsa03s06-in-f14.1e100.net (172.217.160.110): icmp_seq=2 ttl=127 time=15.8 ms

--- google.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 15.786/17.353/18.921/1.567 ms
</code></pre></div>
<h2 id="about">About</h2>
<p>Hi, my name is Jimmy Chang. The current research topic is 5G LAN with a focus on the 5G Data Plane. Any questions or errors in the article are welcome for correction. Please feel free to send an email to provide feedback.</p>
<ul>
<li>Graduate student major in 5GC Research</li>
<li><a href="https://www.linkedin.com/in/%E5%BB%BA%E8%80%80-%E5%BC%B5-94591a235/">LinkedIn</a></li>
</ul>
<h2 id="reference">Reference</h2>
<ul>
<li>https://github.com/s5uishida/free5gc_ueransim_ulcl_sample_config</li>
<li>https://github.com/free5gc/free5gc/blob/main/test_ulcl.sh</li>
<li>https://blog.scottlowe.org/2013/09/04/introducing-linux-network-namespaces/</li>
<li>https://man7.org/linux/man-pages/man7/namespaces.7.html</li>
<li>https://linux.die.net/man/8/iptables</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright Â© free5GC a Series of LF Projects, LLC.
For web site terms of use, trademark policy and other project policies please see https://lfprojects.org.

    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/u/free5gc" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/free5gc/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.facebook.com/profile.php?id=100086840296930" target="_blank" rel="noopener" title="www.facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.6eac0284.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>