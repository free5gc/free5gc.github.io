
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/icon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.3">
    
    
      
        <title>Troubleshooting - free5GC</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.79e020e9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a5377069.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#troubleshooting" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="free5GC" class="md-header__button md-logo" aria-label="free5GC" data-md-component="logo">
      
  <img src="../../assets/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            free5GC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Troubleshooting
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/free5gc/free5gc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    free5GC
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link">
        
  
    
  
  User Guide

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../doc/" class="md-tabs__link">
        
  
    
  
  Documents

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://training.linuxfoundation.org/training/introduction-to-free5gc-lfs114/" class="md-tabs__link">
        
  
    
  
  LFX Course

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/free5gc/free5GLab" class="md-tabs__link">
        
  
    
  
  Tutorials

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../blog/" class="md-tabs__link">
        
  
    
  
  Blogs

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../support/" class="md-tabs__link">
        
  
    
  
  Supports

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../publication/" class="md-tabs__link">
          
  
    
  
  More

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="free5GC" class="md-nav__button md-logo" aria-label="free5GC" data-md-component="logo">
      
  <img src="../../assets/icon.png" alt="logo">

    </a>
    free5GC
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/free5gc/free5gc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    free5GC
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documents
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="https://training.linuxfoundation.org/training/introduction-to-free5gc-lfs114/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LFX Course
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/free5gc/free5GLab" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../blog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blogs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supports
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    More
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            More
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../publication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relavent Publications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../videos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Other Videos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-error-sctp-failed-to-connect-given-amf-n3iwfngap" class="md-nav__link">
    1. ERROR: [SCTP] Failed to connect given AMF N3IWF=NGAP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-testnon3gpp" class="md-nav__link">
    2. TestNon3GPP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-db-on-tls-to-h2c" class="md-nav__link">
    3. DB on TLS to H2C
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-mqcreate-error-creating-message-queue-too-many-open-files-upfutil-upf" class="md-nav__link">
    4. MQCreate() Error creating message queue: Too many open files UPF=Util (UPF)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-remove-gtp-devices-using-tools-in-libgtp5gnl-upf" class="md-nav__link">
    5. Remove gtp devices (using tools in libgtp5gnl) (UPF)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-upf-cli-run-error-open-gtp5g-open-link-create-file-exists" class="md-nav__link">
    6. UPF Cli Run Error: open Gtp5g: open link: create: file exists
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-smf-cannot-communicate-with-upf-upf-cannot-start-after-a-reboot-or-crash" class="md-nav__link">
    7. SMF cannot communicate with UPF / UPF cannot start after a reboot or crash
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-decode-http2-packet-in-wireshark" class="md-nav__link">
    8. Decode HTTP/2 packet in Wireshark
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-decode-h2c-http2-clear-text-without-tls" class="md-nav__link">
    9. Decode H2C (HTTP2 clear text without TLS)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-clear-all-iptables-rules" class="md-nav__link">
    10. Clear all iptables rules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-fix-ueransims-eap-aka-behavior" class="md-nav__link">
    11. Fix UERANSIM's EAP-AKA' behavior
  </a>
  
    <nav class="md-nav" aria-label="11. Fix UERANSIM's EAP-AKA' behavior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-method" class="md-nav__link">
    First method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second-method" class="md-nav__link">
    Second method
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-n3iwue-fails-to-connect-with-erron3ueike-not-success-message" class="md-nav__link">
    12. N3IWUE fails to connect with [ERRO][N3UE][IKE] Not Success message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-unable-to-find-wpa2-eap-encryption-option-in-openwrt-installation" class="md-nav__link">
    13. Unable to find WPA2-EAP encryption option in OpenWrt installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-troubleshooting-missing-packages-when-trying-to-build-tngfue-on-ubuntu" class="md-nav__link">
    14. Troubleshooting missing packages when trying to build TNGFUE on Ubuntu
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/free5gc/free5gc.github.io/blob/main/docs/guide/Troubleshooting.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/free5gc/free5gc.github.io/raw/main/docs/guide/Troubleshooting.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JETJ7TJ805"></script>
<script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-JETJ7TJ805'); </script>

<h1 id="troubleshooting">Troubleshooting</h1>
<h3 id="1-error-sctp-failed-to-connect-given-amf-n3iwfngap">1. <code>ERROR: [SCTP] Failed to connect given AMF    N3IWF=NGAP</code></h3>
<p>This error occured when N3IWF was started before AMF finishing initialization. This error usually appears when you run the TestNon3GPP in the first time.</p>
<p>Rerun the test should be fine. If it still not be solved, larger the sleeping time in line 110 of <code>test.sh</code>.</p>
<h3 id="2-testnon3gpp">2. TestNon3GPP</h3>
<p>TestNon3GPP will modify the <code>config/amfcfg.conf</code>. So, if you had killed the TestNon3GPP test before it finished, you might need to copy <code>config/amfcfg.conf.bak</code> back to <code>config/amfcfg.conf</code> to let other tests pass.</p>
<p><code>cp config/amfcfg.conf.bak config/amfcfg.conf</code></p>
<h3 id="3-db-on-tls-to-h2c">3. DB on TLS to H2C</h3>
<p>If you meet any problems about https or mogodb, it maybe couse our new version from v3.0.1 to v3.0.2 has change http to H2C verion. Try the command below.</p>
<p><code>mongo --eval "db.NfProfile.drop()" free5gc</code></p>
<h3 id="4-mqcreate-error-creating-message-queue-too-many-open-files-upfutil-upf">4. <code>MQCreate() Error creating message queue: Too many open files UPF=Util</code> (UPF)</h3>
<p>Remove POSIX message queues</p>
<div class="highlight"><pre><span></span><code>ls<span class="w"> </span>/dev/mqueue/
rm<span class="w"> </span>/dev/mqueue/*
</code></pre></div>
<h3 id="5-remove-gtp-devices-using-tools-in-libgtp5gnl-upf">5. Remove gtp devices (using tools in libgtp5gnl) (UPF)</h3>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>lib/libgtp5gnl/tools
sudo<span class="w"> </span>./gtp5g-link<span class="w"> </span>del<span class="w"> </span><span class="o">{</span>Dev-Name<span class="o">}</span>
</code></pre></div>
<h3 id="6-upf-cli-run-error-open-gtp5g-open-link-create-file-exists">6. <code>UPF Cli Run Error: open Gtp5g: open link: create: file exists</code></h3>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span>del<span class="w"> </span>upfgtp
</code></pre></div>
<h3 id="7-smf-cannot-communicate-with-upf-upf-cannot-start-after-a-reboot-or-crash">7. SMF cannot communicate with UPF / UPF cannot start after a reboot or crash</h3>
<p>The message below shows up on the logs:</p>
<div class="highlight"><pre><span></span><code>[WARN][SMF][Main] Failed to setup an association with UPF[127.0.0.8], error:Request Transaction [1]: retry-out
</code></pre></div>
<p>Verify on the logs if you got this message:</p>
<div class="highlight"><pre><span></span><code>[ERRO][UPF][Main] UPF Cli Run Error: open Gtp5g: open link: create: operation not supported
</code></pre></div>
<p>If yes, then try to load the GTP module on the system:</p>
<div class="highlight"><pre><span></span><code>modprobe<span class="w"> </span>gtp5g
</code></pre></div>
<p>If this outputs an error like this:</p>
<div class="highlight"><pre><span></span><code>modprobe: FATAL: Module gtp5g not found in directory /lib/modules/5.4.0-xxx-generic
</code></pre></div>
<p>Reinstall the GTP-U kernel module (refer to <a href="../3-install-free5gc/#c-install-user-plane-function-upf">these instructions</a>)</p>
<p>Then, once running the core <code>run.sh</code> script, you should obtain the message on the logs:</p>
<div class="highlight"><pre><span></span><code>[INFO][SMF][Main] Received PFCP Association Setup Accepted Response from UPF[127.0.0.8]
</code></pre></div>
<p>and it should work as normal</p>
<p>After that, if it's required to reload the module, just run <code>modprobe gtp5g</code> again</p>
<p><strong>Note:</strong> The symptoms described above may happen if the host machine updated it's kernel version recently</p>
<p>References: <a href="https://forum.free5gc.org/t/erro-upf-main-upf-cli-run-error-open-gtp5g-open-link-create-operation-not-supported/1795">Free5GC Forum</a> and <a href="../3-install-free5gc/">Install Guide</a></p>
<h3 id="8-decode-http2-packet-in-wireshark">8. Decode HTTP/2 packet in Wireshark</h3>
<ol>
<li>
<p>Run Network Function</p>
<p>Check has XXFsslkey.log</p>
</li>
<li>
<p>Edit &gt;&gt; Preference &gt;&gt; Protocols &gt;&gt; SSL (TLS)</p>
<p><img alt="" src="https://i.imgur.com/dzzMib5.png" /></p>
</li>
<li>
<p>Add keylog</p>
<p><img alt="" src="https://i.imgur.com/gV7x5QU.png" /></p>
</li>
<li>
<p>Filter http2</p>
<p><img alt="" src="https://i.imgur.com/ctBIYQy.png" /></p>
</li>
</ol>
<h3 id="9-decode-h2c-http2-clear-text-without-tls">9. Decode H2C (HTTP2 clear text without TLS)</h3>
<p>The similar reason as NEA0 NAS message. Althrough H2C is clear text, wirshark still considers these packets as the normal TCP packets and does not decode them by HTTP2.</p>
<p>To see the details of H2C packets, do the following configuration.</p>
<ol>
<li>
<p>Analyze → Decode As…</p>
<p><img alt="" src="https://i.imgur.com/NJ2brow.png" /></p>
</li>
<li>
<p>click Add button to add the decode rules</p>
<p><img alt="" src="https://i.imgur.com/Ct4KLgO.png" /></p>
<p>Decode the packets from the TCP ports listened by each NF as HTTP2 packets.</p>
</li>
</ol>
<h3 id="10-clear-all-iptables-rules">10. Clear all iptables rules</h3>
<p>If something went wrong, it's possible to reset iptables' rules back using:<br />
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>iptables<span class="w"> </span>-P<span class="w"> </span>INPUT<span class="w"> </span>ACCEPT
sudo<span class="w"> </span>iptables<span class="w"> </span>-P<span class="w"> </span>FORWARD<span class="w"> </span>ACCEPT
sudo<span class="w"> </span>iptables<span class="w"> </span>-P<span class="w"> </span>OUTPUT<span class="w"> </span>ACCEPT
sudo<span class="w"> </span>iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-F
sudo<span class="w"> </span>iptables<span class="w"> </span>-t<span class="w"> </span>mangle<span class="w"> </span>-F
sudo<span class="w"> </span>iptables<span class="w"> </span>-F
sudo<span class="w"> </span>iptables<span class="w"> </span>-X
</code></pre></div></p>
<p>Then remember to add back the <a href="../5-install-ueransim/#7-testing-ueransim-against-free5gc">rules required</a> by the free5GC.</p>
<p><strong>Note:</strong> You may consider using the <code>reload_host_config.sh</code> script for this task (see <a href="../Appendix/#appendix-h-using-the-reload_host_configsh-script">this appendix section</a>)</p>
<h3 id="11-fix-ueransims-eap-aka-behavior">11. Fix UERANSIM's EAP-AKA' behavior</h3>
<p>If you face issues similar to the one reported on <a href="https://forum.free5gc.org/t/authentication-method-eap-aka-not-working/2260">the forum</a> or the message <code>SEMANTICALLY_INCORRECT_MESSAGE</code> when seting up UERANSIM's UE after configuring it to use EAP-AKA-PRIME as authentication method on Webconsole, check the solution below:</p>
<h4 id="first-method">First method</h4>
<p>Clone the nightly version from commit <code>85a0fbf</code>:</p>
<p>Follow the cloning instructions from <a href="https://free5gc.org/guide/5-install-ueransim/#2-install-ueransim">this guide page here</a></p>
<h4 id="second-method">Second method</h4>
<p>Update your UERANSIM installation with the fix:</p>
<ol>
<li>
<p>Enter UERANSIM's folder (the folder where the source code is already cloned):<br />
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>UERANSIM
</code></pre></div></p>
</li>
<li>
<p>Move the version of your source code to the commit where the fixes were merged:<br />
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>checkout<span class="w"> </span>85a0fbf
</code></pre></div></p>
</li>
<li>
<p>Rebuild UERANSIM<br />
<div class="highlight"><pre><span></span><code>make
</code></pre></div></p>
</li>
</ol>
<h3 id="12-n3iwue-fails-to-connect-with-erron3ueike-not-success-message">12. N3IWUE fails to connect with <code>[ERRO][N3UE][IKE] Not Success</code> message</h3>
<p>As per the instructions on <a href="../n3iwue-installation/#3-use-webconsole-to-add-ue">N3IWUE install guide</a>, the parameters of the configuration file <code>n3ue.yaml</code> must match those on free5GC's database. </p>
<p>If you get log messages like those below:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># on free5GC</span>
<span class="o">[</span>WARN<span class="o">][</span>AMF<span class="o">][</span>Gmm<span class="o">][</span>amf_ue_ngap_id:RU:6,AU:8<span class="o">(</span>Non3GPP<span class="o">)][</span>supi:SUPI:imsi-208930000001234<span class="o">]</span><span class="w"> </span>NAS<span class="w"> </span>MAC<span class="w"> </span>verification<span class="w"> </span>failed<span class="o">(</span>received:<span class="w"> </span>0xc0c0d135,<span class="w"> </span>expected:<span class="w"> </span>0x6f1f9365<span class="o">)</span>
<span class="o">[</span>ERRO<span class="o">][</span>AMF<span class="o">][</span>Gmm<span class="o">][</span>amf_ue_ngap_id:RU:6,AU:8<span class="o">(</span>Non3GPP<span class="o">)][</span>supi:SUPI:imsi-208930000001234<span class="o">]</span><span class="w"> </span>NAS<span class="w"> </span>message<span class="w"> </span>is<span class="w"> </span>ciphered,<span class="w"> </span>but<span class="w"> </span>MAC<span class="w"> </span>verification<span class="w"> </span>failed
<span class="c1"># on N3IWUE</span>
<span class="o">[</span>INFO<span class="o">][</span>N3UE<span class="o">][</span>IKE<span class="o">]</span><span class="w"> </span>Get<span class="w"> </span>EAP
<span class="o">[</span>ERRO<span class="o">][</span>N3UE<span class="o">][</span>IKE<span class="o">]</span><span class="w"> </span>Not<span class="w"> </span>Success
^C4<span class="w"> </span>packets<span class="w"> </span>captured
<span class="m">4</span><span class="w"> </span>packets<span class="w"> </span>received<span class="w"> </span>by<span class="w"> </span>filter
<span class="m">0</span><span class="w"> </span>packets<span class="w"> </span>dropped<span class="w"> </span>by<span class="w"> </span>kernel
<span class="o">[</span>FATA<span class="o">][</span>N3UE<span class="o">][</span>Init<span class="o">]</span><span class="w"> </span>panic:<span class="w"> </span>runtime<span class="w"> </span>error:<span class="w"> </span>invalid<span class="w"> </span>memory<span class="w"> </span>address<span class="w"> </span>or<span class="w"> </span>nil<span class="w"> </span>pointer<span class="w"> </span>dereference
</code></pre></div>
<p>Double check if SQN matches. If not, update it on N3IWUE's side using:</p>
<div class="highlight"><pre><span></span><code>nano<span class="w"> </span>n3iwue/config/n3ue.yaml<span class="w"> </span><span class="c1"># adjust this path if needed</span>
</code></pre></div>
<p>Refer to the <code>Security</code> section on the file:</p>
<div class="highlight"><pre><span></span><code>info:
<span class="w">    </span>version:<span class="w"> </span><span class="m">1</span>.0.1
<span class="w">    </span>description:<span class="w"> </span>Non-3GPP<span class="w"> </span>UE<span class="w"> </span>configuration
configuration:
<span class="w">    </span>N3IWFInformation:
...
<span class="w">    </span>Security:
<span class="w">                </span>K:<span class="w"> </span>b73a90cbcf3afb622dba83c58a8415df
<span class="w">                </span>RAND:<span class="w"> </span>b120f1c1a0102a2f507dd543de68281f
<span class="w">                </span>SQN:<span class="w"> </span>16f3b3f71005
<span class="w">                </span>AMF:<span class="w"> </span><span class="m">8000</span>
<span class="w">                </span>OP:<span class="w"> </span>b672047e003bb952dca6cb8af0e5b779
<span class="w">                </span>OPC:<span class="w"> </span>df0c67868fa25f748b7044c6e7c245b8
</code></pre></div>
<p>Note that SQN is dinamically updated while N3IWUE is running, so this issue might get caused by the N3IWUE being killed during the authentication phase which may cause the value to not match (e.g. it was updated on just one side).</p>
<p>Once the parameters are updated, save and close the configuration file. Now N3IWUE should work correctly.</p>
<h3 id="13-unable-to-find-wpa2-eap-encryption-option-in-openwrt-installation">13. Unable to find WPA2-EAP encryption option in OpenWrt installation</h3>
<p>According to <a href="https://openwrt.org/docs/guide-user/network/wifi/freeradius#configure_wireless_access_point">OpenWrt Wiki</a>, 802.1x authentication is probably missing. This is due <code>wpad-mini</code> package not having it. To solve this, install <code>wpad</code> instead:<br />
1. Login to AP as <code>root</code> using SSH</p>
<p><div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>root@&lt;IP&gt;
<span class="c1"># Example:</span>
ssh<span class="w"> </span>root@192.168.1.1
</code></pre></div><br />
<strong>Tip:</strong> The default IP address is 192.168.1.1, change IP in the command above if your setup requires it.<br />
2. Update package database</p>
<p><div class="highlight"><pre><span></span><code>opkg<span class="w"> </span>update
</code></pre></div><br />
3. Add WPA-EAP support</p>
<p><strong>Note:</strong> Executing the steps below will remove the support for WPA3-SAE on your AP (which may be used by other wireless networks), remember to change the affected Wi-Fi networks to WPA2-PSK</p>
<p><strong>Tip:</strong> To add WPA3 support back, install <code>wpad-openssl</code> instead of <code>wpad</code></p>
<p>A. First Method</p>
<p>Remove <code>wpad-mini</code> and install <code>wpad</code><br />
<div class="highlight"><pre><span></span><code>opkg<span class="w"> </span>remove<span class="w"> </span>wpad-mini
opkg<span class="w"> </span>install<span class="w"> </span>wpad
</code></pre></div></p>
<p>If the commands above fail with the messages <code>No packages removed.</code> or <code>[...] Cannot install package wpad.</code>, try the second method</p>
<p>B. Second Method</p>
<p>Remove <code>wpad-basic-mbedtls</code> and install <code>wpad</code><br />
<div class="highlight"><pre><span></span><code>opkg<span class="w"> </span>remove<span class="w"> </span>wpad-basic-mbedtls
opkg<span class="w"> </span>install<span class="w"> </span>wpad
</code></pre></div><br />
4. Reboot the AP to make sure the new configuration was applied<br />
<div class="highlight"><pre><span></span><code>reboot
</code></pre></div><br />
References: <a href="https://openwrt.org/docs/guide-user/network/wifi/freeradius">OpenWrt Wiki</a> and <a href="https://github.com/openwrt/luci/issues/3363">OpenWrt Github Issue #3363</a></p>
<h3 id="14-troubleshooting-missing-packages-when-trying-to-build-tngfue-on-ubuntu">14. Troubleshooting missing packages when trying to build TNGFUE on Ubuntu</h3>
<p>First, remember to update packages source before installing packages<br />
<div class="highlight"><pre><span></span><code>sudo apt update
</code></pre></div></p>
<p>To install all prerequisites in one line:<br />
<div class="highlight"><pre><span></span><code>sudo apt install libssl-dev libdbus-1-dev libnl-3-dev libnl-genl-3-dev libnl-route-3-dev
</code></pre></div></p>
<p><strong>(Alternatively)</strong> Error messages and their related packages:</p>
<ul>
<li>openssl/ssl.h: No such file or directory<br />
<div class="highlight"><pre><span></span><code>sudo apt install libssl-dev
</code></pre></div></li>
<li>dbus/dbus.h: No such file or directory<br />
<div class="highlight"><pre><span></span><code>sudo apt install libdbus-1-dev
</code></pre></div></li>
<li>netlink/netlink.h: No such file or directory<br />
<div class="highlight"><pre><span></span><code>sudo apt install libnl-3-dev
</code></pre></div></li>
<li>/usr/bin/ld: cannot find -lnl-genl-3<br />
<div class="highlight"><pre><span></span><code>sudo apt install libnl-genl-3-dev
</code></pre></div></li>
<li>/usr/bin/ld: cannot find -lnl-route-3<br />
<div class="highlight"><pre><span></span><code>sudo apt install libnl-route-3-dev
</code></pre></div></li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © free5GC a Series of LF Projects, LLC.
For web site terms of use, trademark policy and other project policies please see https://lfprojects.org.

    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/u/free5gc" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/free5gc/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.facebook.com/profile.php?id=100086840296930" target="_blank" rel="noopener" title="www.facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6eac0284.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>